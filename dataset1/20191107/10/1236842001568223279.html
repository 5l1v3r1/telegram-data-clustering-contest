<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://dtf.ru/gamedev/79680-sozdanie-procedurnoy-animacii-vsego-iz-13-keyfreymov-opyt-razrabotchika-overgrowth"/>
    <meta property="og:site_name" content="DTF"/>
    <meta property="article:published_time" content="2019-11-07T10:32:24+00:00"/>
    <meta property="og:title" content="Создание процедурной анимации всего из 13 кейфреймов — опыт разработчика Overgrowth"/>
    <meta property="og:description" content="Внимание к мелочам и поэтапное формирование движений героя."/>
  </head>
  <body>
    <article>
      <h1>Создание процедурной анимации всего из 13 кейфреймов — опыт разработчика Overgrowth</h1>
      <address><time datetime="2019-11-07T10:32:24+00:00">07 Nov 2019, 10:32</time> by <a rel="author">Владимир Семыкин</a></address>
      <p>Внимание к мелочам и поэтапное формирование движений героя.</p>
      <p>Аниматор Дэвид Розен из Wolfire Games на GDC 2014 выступил с докладом о создании анимации для игры <a href="https://store.steampowered.com/app/25000">Overgrowth</a>. Спикер рассказал о каждом этапе анимирования персонажей и показал финальный результат своей работы. Мы выбрали из доклада главное.</p>
      <figure>
        <iframe src="https://www.youtube.com/embed/LNidsMesxSE" width="640" height="360" data-service="Youtube" scrolling="no"/>
      </figure>
      <p>Сама Overgrowth была анонсирована ещё в 2008 году, но вышла только в 2017-м. Игра представляет собой экшен от третьего лица, в котором антропоморфные звери участвуют в кровавых битвах друг с другом.</p>
      <figure>
        <iframe src="https://www.youtube.com/embed/E2s077vLWgU" width="640" height="360" data-service="Youtube" scrolling="no"/>
      </figure>
      <p>По словам спикера, при создании анимации всегда возникает вопрос того, насколько отзывчивой она должна быть. Например, с одной стороны есть Super Mario Bros., в которой герой мгновенно выполняет все команды игрока. При этом для анимирования его движений используется всего несколько кадров.</p>
      <p>На другой стороне находится <a href="https://ru.wikipedia.org/wiki/Prince_of_Persia_(%D0%B8%D0%B3%D1%80%D0%B0,_1989)">Prince of Persia</a>, в которой применяется ротоскопия, а все движения героя выглядят очень плавными. Из-за этого во время перехода от одной анимации к другой пользователь не может управлять героем. К тому же появляется задержка при передаче команд.</p>
      <p>Чтобы адекватно анимировать персонажа, важно уметь анализировать движения обычных людей. Например, если посмотреть на фигуриста, то можно увидеть, что его центр масс редко совершает резкие переходы от одного состояния к другому — траектория движения больше похожа на простую кривую преимущественно в горизонтальной плоскости.</p>
      <figure>
        <img src="https://leonardo.osnova.io/3a4b35c0-1947-275c-fb2d-afdb839d1cf4/"/>
      </figure>
      <p>Но фигурист должен следовать некоторым правилам. Например, ему нужно держать центр масс над коньками, чтобы не упасть. Также он должен наклоняться в сторону, в которую будет ускоряться. А при вращении ему нужно контролировать скорость с помощью разведения рук.</p>
      <p>При создании анимации в Overgrowth Дэвид решил начать с базовых движений. Зелёная сфера соприкасается с объектами на высоте туловища героя, а белая реагирует на мелкие препятствия на земле. Главный принцип, который лежит в основе движений в Overgrowth — это отзывчивость управления и предсказуемость: если герой падает с утёса, то геймер понимает, что это его вина, а не игры.</p>
      <p>Такой подход означает, что именно движения имеют главный приоритет, а анимация должна накладываться на них, но не перекрывать.</p>
      <figure>
        <video src="https://giant.gfycat.com/ScarceDelectableHarborseal.mp4" autoplay="" loop=""/>
      </figure>
      <p>Первый шаг — подставить вместо сферы персонажа, который находится в idle-позе. При этом игрок может управлять лишь скоростью героя и направлением движения. А следующий шаг, это добавление наклона при ускорении. Поворот при этом происходит относительно центра масс.</p>
      <figure>
        <video src="https://giant.gfycat.com/KnobbyGleamingAmericanrobin.mp4" autoplay="" loop=""/>
        <figcaption>Здесь вы можете увидеть, как сперва герой просто передвигается в idle-позе, а потом к этому добавляется наклон</figcaption>
      </figure>
      <p>Чтобы сымитировать бег, разработчик добавил две ключевые позы героя — переходную и конечную. Эти кейфреймы сменяются, когда персонаж делает шаг, а скорость смены зависит от скорости передвижения. На гифке можно увидеть, как колесо отсчитывает расстояние, которое проходит персонаж, а также отражает его скорость.</p>
      <figure>
        <video src="https://giant.gfycat.com/VerifiableSpottedCatbird.mp4" autoplay="" loop=""/>
      </figure>
      <p>Тем не менее это подходит для бега, но не для передвижения шагом. Поэтому Дэвид добавил ещё один набор анимации для низкой скорости. Здесь работает тот же принцип, но расстояние между шагами значительно меньше по сравнению с бегом.</p>
      <figure>
        <video src="https://giant.gfycat.com/AllCheerfulBlackfish.mp4" autoplay="" loop=""/>
      </figure>
      <p>Чтобы смена анимаций не была рваной, автор смешал их, благодаря чему появились правдоподобные переходы между состояниями при изменении скорости.</p>
      <figure>
        <video src="https://giant.gfycat.com/CooperativeQuarterlyDormouse.mp4" autoplay="" loop=""/>
      </figure>
      <p>Также Дэвид добавил эффект незначительного подпрыгивания во время передвижения героя. Чем меньше скорость, тем больше дуга.</p>
      <figure>
        <video src="https://giant.gfycat.com/UnfinishedHonestAsiantrumpetfish.mp4" autoplay="" loop=""/>
      </figure>
      <p>Два кейфрейма — это слишком мало для полноценной анимации, поэтому разработчик добавил переходные состояния, которые нашёл с помощью вычисления среднего значения между ближайшими друг к другу кадрами.</p>
      <p>На анимации ниже можно увидеть, что при использовании линейной интерполяции переходы между действиями всё ещё достаточно резкие. Дэвид исправил это с помощью бикубической интерполяции, которая позволила сымитировать инерцию и сделать движения более плавными и естественными.</p>
      <figure>
        <video src="https://giant.gfycat.com/VastDarlingIberianchiffchaff.mp4" autoplay="" loop=""/>
      </figure>
      <p>Подобные манипуляции разработчик совершил и с анимацией приседания. Сперва у него было только две позы — в полный рост и пригнувшись. Он использовал линейную интерполяцию, чтобы сделать переходы между позами, а затем добавил небольшой эффект покачивания, чтобы движения выглядели правдоподобными.</p>
      <figure>
        <video src="https://giant.gfycat.com/ElatedOnlyDorado.mp4" autoplay="" loop=""/>
      </figure>
      <p>Следующий шаг — совмещение анимации бега и приседания.</p>
      <figure>
        <video src="https://giant.gfycat.com/DetailedPersonalAustrianpinscher.mp4" autoplay="" loop=""/>
      </figure>
      <p>При создании анимации приземления Дэвиду не пришлось придумывать что-то новое — он просто использовал эффект подавления инерции при приседании.</p>
      <figure>
        <video src="https://giant.gfycat.com/NauticalDarkGoral.mp4" autoplay="" loop=""/>
      </figure>
      <p>В игре есть возможность делать сальто во время прыжка, чтобы изменить направление героя. Если персонаж моментально совершает действие, то это выглядит неестественно. Поэтому Дэвид сделал так, чтобы герой прямо перед совершением сальто немного отклонялся в сторону и сохранял момент импульса.</p>
      <figure>
        <video src="https://giant.gfycat.com/MellowLongBluebird.mp4" autoplay="" loop=""/>
      </figure>
      <p>Перекат очень похож по анимации на сальто, но главное отличие заключается в том, что на земле герой делает кувырок через плечо.</p>
      <figure>
        <video src="https://giant.gfycat.com/SmugColorfulHammerkop.mp4" autoplay="" loop=""/>
      </figure>
      <p>Вот так в движении выглядит персонаж, у которого готовы все основные анимации. Для получения этого результата Дэвид использовал всего 13 кейфреймов. Преимущество этого подхода заключается в том, что разработчик может без проблем добавлять новые элементы. Например, он может дать герою в руки копьё, и разработчику не придётся заново создавать все анимации.</p>
      <figure>
        <video src="https://giant.gfycat.com/MiniatureGlaringDamselfly.mp4" autoplay="" loop=""/>
      </figure>
      <p>Несмотря на то, что основные анимации готовы, есть ещё множество деталей, которые требуют доработки. Например, Дэвид использовал инверсную кинематику, чтобы герой ставил ногу на камни под правильным углом. По словам разработчика, чтобы высчитать этот угол, достаточно простой тригонометрии.</p>
      <figure>
        <video src="https://giant.gfycat.com/WarmheartedVengefulHornedtoad.mp4" autoplay="" loop=""/>
      </figure>
      <p>Такое же решение разработчик использовал и для анимации карабканья, которая состоит всего из одного кейфрейма.</p>
      <figure>
        <video src="https://giant.gfycat.com/ShockedSecretDogfish.mp4" autoplay="" loop=""/>
      </figure>
      <p>Разработчик также использовал инверсную кинематику, чтобы герой следил за противником. Это помогает сделать персонажа более живым.</p>
      <figure>
        <video src="https://giant.gfycat.com/InsignificantInbornAlaskajingle.mp4" autoplay="" loop=""/>
      </figure>
      <p>Ещё одна деталь, которая требовала доработки — это колебания частей тела героя при движении. Каждая анимация имеет свой параметр мягкости для каждой «кости». Например, ниже можно увидеть, что уши и руки персонажа колеблются при его движениях.</p>
      <figure>
        <video src="https://giant.gfycat.com/PlainPleasedCivet.mp4" autoplay="" loop=""/>
      </figure>
      <p>Ближе к концу создания анимации разработчик занялся поиском ситуаций, в которых движения героя выглядят странно или глупо. Например, Дэвид заметил, что во время прыжка рядом со стеной персонаж просто утыкается в неё, но никак не реагирует на это препятствие. Поэтому автор добавил анимацию простого бега по стене, из-за чего одна из глупейших ситуаций в игре превратилась в одну из крутейших.</p>
      <figure>
        <video src="https://giant.gfycat.com/ShadowySmoothIndianpalmsquirrel.mp4" autoplay="" loop=""/>
      </figure>
      <p>При падениях персонажа используется ragdoll-физика — разработчик постарался сделать так, чтобы в такие моменты герой выглядел не как безжизненная кукла, а сохранял элементы обычного поведения.</p>
      <figure>
        <video src="https://giant.gfycat.com/MeekDeafeningGalapagospenguin.mp4" autoplay="" loop=""/>
        <figcaption>Здесь можно увидеть, как персонаж пытается идти в положении лёжа. Но у него это получается не очень хорошо</figcaption>
      </figure>
      <p>Чтобы сделать поведение героя более правдоподобным, разработчик сделал так, чтобы персонаж пытался защищать свою голову и тело при падении. На заключительных кадрах анимации видно, что у него это получается не всегда хорошо.</p>
      <figure>
        <video src="https://giant.gfycat.com/CooperativeSelfishDogfish.mp4" autoplay="" loop=""/>
      </figure>
      <p>В заключение Дэвид рассказал о своих надеждах на будущее анимации. Его главным желанием было, чтобы со временем появилось больше инструментов, которые позволяют облегчить задачу аниматоров. Например, чтобы им не приходилось создавать множество переходных состояний.</p>
    </article>
  </body>
</html>