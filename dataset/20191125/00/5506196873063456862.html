<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://3dtoday.ru/blogs/brn/alternativnyy-sposob-poluchit-dostup-k-octoprint-izvnea"/>
    <meta property="og:site_name" content="3dtoday.ru"/>
    <meta property="article:published_time" content="2019-11-25T00:00:00+00:00"/>
    <meta property="og:title" content="Альтернативный способ получить доступ к Octoprint извне"/>
    <meta property="og:description" content="Листая старую тетрадь расстрелянного генерала, я как-то видел, что у кого-то на 3dtoday были проблемы с организацией доступа к Octoprint через Интернет. Стандартный способ предельно прост, на самом деле: зайти на роутер, дать фиксированный ip-адрес octoprint, настроить порт-форвардинг на него, зайти в раздел DDNS роутера, зарегистрироваться на каком-нибудь поддерживаемом DDNS, настроить. Но это и очень просто и очень сложно и не всегда работает :-). Вот например у меня дома две сети, возможность пробросить порт через 2 сети есть и я так непременно сделаю, но есть ещё одна проблема: Ростелеком. Иногда мне выдают &quot;серый&quot; IP, к которому невозможно подключиться извне и способ с DDNS не работает."/>
  </head>
  <body>
    <article>
      <h1>Альтернативный способ получить доступ к Octoprint извне</h1>
      <address><time datetime="2019-11-25T00:00:00+00:00">25 Nov 2019</time> by <a rel="author" href="https://3dtoday.ru/blogs/brn" target="_blank">brn</a></address>
      <p>Листая старую тетрадь расстрелянного генерала, я как-то видел, что у кого-то на 3dtoday были проблемы с организацией доступа к Octoprint через Интернет. Стандартный способ предельно прост, на самом деле: зайти на роутер, дать фиксированный ip-адрес octoprint, настроить порт-форвардинг на него, зайти в раздел DDNS роутера, зарегистрироваться на каком-нибудь поддерживаемом DDNS, настроить. Но это и очень просто и очень сложно и не всегда работает :-). Вот например у меня дома две сети, возможность пробросить порт через 2 сети есть и я так непременно сделаю, но есть ещё одна проблема: Ростелеком. Иногда мне выдают "серый" IP, к которому невозможно подключиться извне и способ с DDNS не работает.</p>
      <p>Но так получилось, что я разработчик и знаю ещё один "запасной" способ, которым хочу поделиться, вдруг пригодится. Пример для образа Raspbian с предустановленным Octoprint для Raspberry PI 3 (ARM), для AMD64 или ARM64 всё то же самое, просто надо будет скачать другой архив. Пользователь pi, если пользователь другой - тоже надо будет указать правильного пользователя.</p>
      <p>Способ этот - локальный туннель, например ngrok.com или localtunnel.me. Я буду рассказывать на примере ngrok. Кстати, сегодня для меня была недоступна панель управления ngrok без VPN, возможно она пала жертвой Роскомнадзора. Для начала надо будет зайти на ngrok.com и зарегистрироваться там, там же можно получить свой authkey. В моём дистрибутиве Octoprint версия ngrok безнадёжно устаревшая и уже не работает, так что логинимся на нашу "пишку" и яростно фигачим команды!</p>
      <p>Кстати, строчки "pi@octopi:~ $" или "root@octopi:~#" вводить не нужно, это то, что сервер вам говорит.</p>
      <p>Сначала скачаем с <a href="https://ngrok.com/download">https://ngrok.com/download</a> версию для ARM.</p>
      <p>pi@octopi:~ $ <b>wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-arm.zip</b></p>
      <p>2019-11-24 19:41:43 (2.76 MB/s) - ‘ngrok-stable-linux-arm.zip’ saved [13091884/13091884]</p>
      <p>pi@octopi:~ $ <b>unzip ngrok-stable-linux-arm.zip</b> </p>
      <p>pi@octopi:~ $ <b>sudo mv ngrok /usr/local/sbin/</b></p>
      <p>pi@octopi:~ $ <b>ngrok authtoken</b> мой-auth-token</p>
      <p>Authtoken saved to configuration file: /home/pi/.ngrok2/ngrok.yml</p>
      <p>pi@octopi:~ $ <b>echo 'region: eu' &gt;&gt; .ngrok2/ngrok.yml</b></p>
      <p>pi@octopi:~ $ <b>echo 'console_ui: iftty' &gt;&gt; .ngrok2/ngrok.yml</b> </p>
      <p>Запускаем <b>ngrok http 80</b>, получаем результат, текстовый интерфейс, в котором написано что-то вроде Forwarding http://ac60ba17.eu.ngrok.io -&gt; localhost:80. </p>
      <p>Кстати, если вы находитесь в США, поменяйте в ngrok.yml регион на us, или переместитесь в прошлое и не вводите команду echo 'region: eu' &gt;&gt; .ngrok2/ngrok.yml </p>
      <p>В принципе, это всё, теперь можно входить на адрес ac60ba17.eu.ngrok.io, до тех пор, пока не закроете это окошко. Что значит "уже закрыли"? И даже сами нашли, что CTRL+C для закрытия?</p>
      <p>Да ладно, сам знаю, что octoprint - он в основном для людей, которые хотят легко и удобно, поэтому поступим иначе. Нам нужен root, желательно весь! Пишем <b>sudo su -</b>, вводим пароль, если у вас требуется пароль. Надо создать файл <b>/etc/systemd/system/ngrok.service</b>, если умеете пользоваться vim или другим консольным редактором, рекомендую этот способ (вот пример <a href="https://gist.github.com/balkin/0e74d29a0ac61169ca7b57114a401d8e">https://gist.github.com/balkin/0e74d29a0ac61169ca7b57114a401d8e</a>). Если доверяете незнакомым людям в интернете, то вот так можно сделать:</p>
      <p>
        <b>wget -O /etc/systemd/system/ngrok.service https://gist.github.com/balkin/0e74d29a0ac61169ca7b57114a401d8e/raw/89ffd3ae5a4df6bd92bcb2f0d657974d82fa12f5/ngrok.service</b>
      </p>
      <p>root@octopi:~# <b>systemctl enable ngrok</b></p>
      <p>Created symlink /etc/systemd/system/multi-user.target.wants/ngrok.service → /etc/systemd/system/ngrok.service.</p>
      <p>root@octopi:~# <b>systemctl restart ngrok</b></p>
      <p>Адрес туннеля можно найти вот тут: <a href="https://dashboard.ngrok.com/status">https://dashboard.ngrok.com/status</a>, при перезапуске ngrok или ОС он может</p>
      <p>Не забудьте, что злые русские хакеры могут взломать не только 3d-принтер, но даже президента! Обязательно установите надёжный пароль на ваш Octoprint. Кстати, пароль cjhjrnsczxj,tpmzyd;jgeceyekb,fyfy не может считаться надёжным, он уже скомпрометирован.</p>
      <p>P.S., P.P.S. и P.P.P.S.: Обычно этот сервис используется для того, чтобы предоставить доступ к локальному API в интернет. Если будете круглосуточно смотреть веб-камеру через интернет, то скорее всего, скорость вам срежут или вообще аккаунт заблокируют. А вот если пользоваться этой мордой только с работы (да вы и не захотите из локальной сети это делать, оно вообще-то тормозит), при этом камеру смотреть изредка - всё будет хорошо.</p>
      <p>Если вдруг не получилось, могу попробовать помочь, пишите :) Хотя это всё точно работает, я свои логи из консоли выложил и дописал немножко текста.</p>
      <p>Если вдруг это не считается "Техничкой", можно переместить в личные дневники :)</p>
    </article>
  </body>
</html>