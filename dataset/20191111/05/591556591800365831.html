<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://www.zdnet.com/article/bluekeep-exploit-to-get-a-fix-for-its-bsod-problem/"/>
    <meta property="og:site_name" content="ZDNet"/>
    <meta property="article:published_time" content="2019-11-11T05:30:07+00:00"/>
    <meta property="og:title" content="BlueKeep exploit to get a fix for its BSOD problem"/>
    <meta property="og:description" content="Microsoft's Meltdown patch was causing BlueKeep attacks to crash on some systems."/>
  </head>
  <body>
    <article>
      <h1>BlueKeep exploit to get a fix for its BSOD problem</h1>
      <address><time datetime="2019-11-11T05:30:07+00:00">11 Nov 2019, 05:30</time> by <a rel="author" href="https://www.zdnet.com/meet-the-team/us/catalin.cimpanu/" target="_blank">Catalin Cimpanu</a></address>
      <p>
        <b>Microsoft's Meltdown patch was causing BlueKeep attacks to crash on some systems.</b>
      </p>
      <figure>
        <img src="https://zdnet3.cbsistatic.com/hub/i/2019/11/11/8b66182d-80e4-4ca2-a4fe-dfbbb92b7501/acf23dab38fedd096a1442d1f5b1d36d/exploit-globe-code-cyber.jpg"/>
      </figure>
      <p>Currently, the only public proof-of-concept exploit code for the infamous BlueKeep vulnerability is a module for the Metasploit penetration testing framework.<br/><br/>The BlueKeep Metasploit module was put together from a proof-of-concept code donated by RiskSense security researcher Sean Dillon (<a href="https://twitter.com/zerosum0x0/">@zerosum0x0</a>) over the summer.<br/><br/>While the exploit works, it has a downside, namely that on some systems it can crash the target with a Blue Screen of Death (BSOD) error, instead of granting the attackers a remote shell.<br/><br/>This BSOD error is how security researcher Kevin Beaumont discovered the first BlueKeep-based attacks in the real-world last week after he noticed that 10 of his 11 RDP honeypots were down with a BSOD error.<br/><br/>However, this week, the BlueKeep Metasploit module will get a fix for this bug. The fix removes the BSOD error and makes BlueKeep attacks more reliable.</p>
      <h3>BlueKeep was crashing because of the Meltdown patch</h3>
      <p>In an interview with <i>ZDNet </i>over the weekend, Dillon said the root cause of the BSOD errors was Microsoft's patch for the Meltdown Intel CPU vulnerability.<br/><br/>"From looking at screenshots of <a href="https://www.malwaretech.com/2019/09/bluekeep-a-journey-from-dos-to-rce-cve-2019-0708.html">the analysis Marcus 'MalwareTech' Hutchins did</a>, we know code execution was achieved and that the honeypots were crashing because the exploit did not support kernels with Meltdown," Dillon told <i>ZDNet</i>.</p>
      <p>"The future BlueKeep Metasploit exploit will support kernels patched for Meltdown and does not even need a KVA Shadow mitigation bypass," he said.<br/><br/><i>[KVA Shadow is the technical name that Microsoft gave to the Meltdown patch. <a href="https://msrc-blog.microsoft.com/2018/03/23/kva-shadow-mitigating-meltdown-on-windows/">See here for details</a>.]</i><br/><br/>The new BlueKeep exploit changes the exploit routine early in a BlueKeep attack, so a Meltdown patch bypass isn't even needed. Diving deeper into the technical details, Dillon told <i>ZDNet</i>:<br/><br/>"For the [BlueKeep] exploit payload to transition from kernel mode to a traditional user-mode payload (such as reverse TCP shell callback), we were changing the system call register in a way that was not allowed by the Meltdown KVA Shadow mitigation. After writing a bypass for the KVA Shadow mitigation, it was pointed out that the exploit payload could be written without needing to hook the system call at all. The need for a Meltdown bypass is actually unnecessary and part of wrong assumptions early on in the exploit development That is the fix that will be going in."<br/><br/>Dillon expects the Metasploit project to update the BlueKeep module <a href="https://github.com/rapid7/metasploit-framework/pull/12553">later this week</a>. A technical deep-dive into the root cause of the BlueKeep BSOD is also available on Dillon's personal blog, <a href="https://zerosum0x0.blogspot.com/2019/11/fixing-remote-windows-kernel-payloads-meltdown.html#kva_conclusion">here</a>.</p>
      <h3>Some perspective from MalwareTech</h3>
      <p>What this means for all of us is pretty obvious. BlueKeep's public exploit is getting more reliable, meaning attackers have a higher chance of breaking into a company that runs at least one vulnerable system.<br/><br/>As Hutchins pointed out <a href="https://twitter.com/MalwareTechBlog/status/1192926816370970625">in a Twitter thread</a> last week, the cyber-security community has focused too much on Microsoft's initial warning that BlueKeep could be used to create "wormable malware."<br/><br/>The result was that everybody missed the point that even if attackers don't create a BlueKeep-based worm, BlueKeep is still a major threat and should not be ignored.<br/><br/>"I'm not really worried about a worm, what I'm worried about is something that could be already happening," Hutchins said.<br/><br/>"Most BlueKeep vulnerable devices are servers. Generally speaking, Windows servers have the ability to control devices on the network. Either they're domain admin, have network management tools installed, or share the same local admin credentials with the rest of the network. By compromising a network server, it is almost always extremely easy to use automated tooling to pivot internally (Ex: have the server drop ransomware to every system on the network)," he added.<br/><br/>"The real risk with BlueKeep is not a worm. A worm is pointless and noisy. Once an attacker is on the network, they can do far more damage with standard automated tools than they could ever do with BlueKeep," Hutchins said.<br/><br/>"Remember all those news stories about entire networks being ransomwared? That starts with a single system being hacked. Not even a server, a normal, non admin, client system. Attackers don't need worms.<br/><br/>"People need to stop worrying about worms and start worrying about basic network security. Firewall your servers off from the internet, learn about credential hygiene. Occasionally worms happen, but every day there are entire networks compromised using only standard tools."</p>
      <figure>
        <iframe data-src="https://twitter.com/MalwareTechBlog/status/1192926816370970625?ref_src=twsrc%5Etfw" data-embed-type="twitter-tweet" width="100%" height="0" data-service="Twitter" scrolling="no" nowide=""/>
      </figure>
      <h3>The BlueKeep lowdown</h3>
      <p>Because there's been a flood of BlueKeep-related coverage this year, below is a summary of what you need to know. Just the essentials:</p>
      <ul>
        <li>BlueKeep is a nickname given to CVE-2019-0708, a vulnerability in the Microsoft RDP (Remote Desktop Protocol) service.</li>
        <li>BlueKeep impacts only: Windows 7, Windows Server 2008 R2, Windows Server 2008.</li>
        <li>Patches have been available since mid-May 2019. <a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708">See official Microsoft advisory</a>.</li>
        <li>On the same day it released patches, Microsoft published a blog post <a href="https://msrc-blog.microsoft.com/2019/05/14/prevent-a-worm-by-updating-remote-desktop-services-cve-2019-0708/">warning about BlueKeep being wormable</a>.</li>
        <li><a href="https://blogs.technet.microsoft.com/msrc/2019/05/30/a-reminder-to-update-your-systems-to-prevent-a-worm/">Microsoft issued a second warning</a> about orgs needing to patch BlueKeep, two weeks later, at the end of May.</li>
        <li>The <a href="https://www.nsa.gov/News-Features/News-Stories/Article-View/Article/1865726/nsa-cybersecurity-advisory-patch-remote-desktop-services-on-legacy-versions-of/">US National Security Agency</a>, the <a href="https://www.us-cert.gov/ncas/alerts/AA19-168A">US Department of Homeland Security</a>, <a href="https://www.bsi.bund.de/DE/Presse/Pressemitteilungen/Presse2019/Windows-Schwachstelle-RDP-150519.html">Germany's BSI</a> cyber-security agency, the <a href="https://www.cyber.gov.au/news/protect-against-BlueKeep">Australian Cyber Security Centre</a>, and the <a href="https://www.ncsc.gov.uk/report/weekly-threat-report-31st-may-2019">UK's National Cyber Security Centre</a> have all issued their own security alerts, trying to get companies to patch outdated computer fleets.</li>
        <li>Many security researchers and cyber-security firms developed fully-working BlueKeep exploits over the summer; however, nobody published the code after realizing how dangerous the exploit was, and fearing that it could be abused by malware authors.</li>
        <li>In July, a US company started <a href="https://www.zdnet.com/article/us-company-selling-weaponized-bluekeep-exploit/">selling a private BlueKeep exploit</a> to its customers, so they could test if their systems were vulnerable.</li>
        <li>In September, the developers of the Metasploit penetration testing framework <a href="https://www.zdnet.com/article/metasploit-team-releases-bluekeep-exploit/">published the first public BlueKeep proof-of-concept exploit</a>.</li>
        <li>In late October, malware authors started using this BlueKeep Metasploit module in a real-world campaign. Microsoft has an article about this malware campaign <a href="https://www.microsoft.com/security/blog/2019/11/07/the-new-cve-2019-0708-rdp-exploit-attacks-explained/">here</a>.</li>
        <li>According to BinaryEdge, there are roughly 700,000 internet-connected Windows systems that are vulnerable to BlueKeep, and have yet to receive patches.</li>
      </ul>
    </article>
  </body>
</html>