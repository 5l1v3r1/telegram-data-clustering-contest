<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://www.zdnet.com/article/manual-code-review-finds-35-vulnerabilities-in-8-enclave-sdks/"/>
    <meta property="og:site_name" content="ZDNet"/>
    <meta property="article:published_time" content="2019-11-12T18:00:00+00:00"/>
    <meta property="og:title" content="Manual code review finds 35 vulnerabilities in 8 enclave SDKs"/>
    <meta property="og:description" content="All issues have been privately reported and patches are available."/>
  </head>
  <body>
    <article>
      <h1>Manual code review finds 35 vulnerabilities in 8 enclave SDKs</h1>
      <address><time datetime="2019-11-12T18:00:00+00:00">12 Nov 2019, 18:00</time> by <a rel="author" href="https://www.zdnet.com/meet-the-team/us/catalin.cimpanu/" target="_blank">Catalin Cimpanu</a></address>
      <p>
        <b>All issues have been privately reported and patches are available.</b>
      </p>
      <figure>
        <img src="https://zdnet2.cbsistatic.com/hub/i/2019/11/12/9dabc57d-d3c4-49e3-81f3-169b7dd108c7/accfe4071b5e6d5ff19f3dbb920b9b58/intel-cpu-sgx-motherboard.jpg"/>
      </figure>
      <p>A team of British and Belgium academics looked at eight open-source enclave SDKs and found 35 vulnerabilities that can be exploited to run malicious code inside a computer's most secure area.<br/><br/>A trusted execution environment (TEE), also known as an enclave, is a secure area of a CPU that can be isolated at the hardware or software level from the rest of the computer.<br/><br/>Modern-day computing systems, and especially cloud computing servers, often rely on enclaves. Laptops or desktops use enclaves to safely store an app's passwords or encryption keys, while servers use enclaves to isolate the data of different cloud server tenants. While desktop apps may not use enclaves to safeguard their data all the day, modern-day cloud computing wouldn't be possible without them. The CPU enclave is at the heart of every major cloud hosting service, and is what makes hypervisor technologies possible.<br/><br/>Currently, enclaves are supported by various underlying hardware-based technologies such as Intel's Software Guard Extensions (SGX), ARM's TrustZone, RISC-V's Keystone, Qualcomm's Secure Execution Environment (QSEE), or KU Leuven's Sancus.<br/><br/>Developers who want to build software that takes advantage of an enclave and use its isolated environment to store sensitive information must use a software development kit (SDK).</p>
      <p>These SDKs provide an interface so an app can interact with the underlying enclave technology. But besides interfacing, the role of these SDKs is to also shield the enclave at a software level from malicious code that may be running at the OS level. For example, an SDK must be able to detect malicious instructions that may be used in attempts to exfiltrate data from the enclave.<br/><br/>It's these enclave SDK shielding features that the research team looked at in their recent work. More specifically, academics looked at the eight SDKs:</p>
      <ul>
        <li><a href="https://github.com/intel/linux-sgx">Intel SGX-SDK</a> (on Intel SGX)</li>
        <li><a href="https://openenclave.io/sdk/">Microsoft OpenEnclave</a> (on Intel SGX)</li>
        <li><a href="https://grapheneproject.io/">Graphene</a> (on Intel SGX)</li>
        <li><a href="https://github.com/lsds/sgx-lkl">SGX-LKL</a> (on Intel SGX)</li>
        <li><a href="https://fortanix.com/products/runtime-encryption/edp/">Rust-EDP</a> (on Intel SGX)</li>
        <li><a href="https://cloud.google.com/blog/products/gcp/introducing-asylo-an-open-source-framework-for-confidential-computing">Google Asylo</a> (on Intel SGX)</li>
        <li><a href="https://keystone-enclave.org/">Keystone</a> (on RISC-V)</li>
        <li><a href="https://distrinet.cs.kuleuven.be/software/sancus/">Sancus</a> (on Sancus)</li>
      </ul>
      <h3>A long running research project</h3>
      <p>The research team's work involved auditing all eight projects by performing manual code reviews of possibly vulnerable SDK functions that could be exploited for attacks.<br/><br/>"This was, indeed, quite a long-running project," Jo Van Bulck, an academic from KU Leuven, involved in the research told <i>ZDNet</i> in an email.<br/><br/>"Some of the findings even date back to 2015, when I studied the security of the Sancus research platform. After that, somewhere in 2016, I found a very similar issue in Graphene and reported it, and it got fixed," Van Bulck added.<br/><br/>"We had an intuition there might be more there but were busy with other things and somewhat forgot about this attack surface. Then in 2018, I found CVE-2018-3626 when reviewing Intel software for Spectre vulnerabilities. Then in November 2018, I met David Oswald and the other people from Birmingham University at a research conference in London, and we started talking about how all of these findings fit in a bigger picture, and we set off to investigate this attack surface more systematically together.<br/><br/>"As part of our research, we developed a sort of intuitive methodology to make these code reviews more feasible. Basically, we focus on following the code path in and out of the victim enclave software with an 'attacker hat' on thinking about what could go wrong each step of the way," Van Bulck told <i>ZDNet</i>.<br/><br/>"Crucially, since we only focus on the entry/exit code, the amount of lines of code to digest is way more manageable than having to review all of the code (which would be completely infeasible). It also greatly helped to develop a scientific classification scheme for these vulns such that we saw the same mistakes being repeated across independent projects, and we often found one vulnerbility and then reviewed the other projects and found the same oversights there."</p>
      <h3>Vulnerabilities are fully exploitable, not just theoretical</h3>
      <p>In total, researchers said their manual code audit found 35 vulnerabilities across all the eight SDKs, of which, five received a CVE identifier.<br/><br/>"We practically exploit these vulnerabilities in several attack scenarios to leak secret keys from the enclave or enable remote code reuse," the research team said, describing the severity of the vulnerabilities they found.<br/><br/>"The five CVEs are assigned by Intel and Microsoft for the vulnerabilities we found in their production-quality real-world deployed software. And we also show how these are indeed exploitable with quite worrisome consequences (e.g. leading to memory corruption and full AES key recovery)," Van Bulck told <i>ZDNet</i>.<br/><br/>"For the other vulnerabilities, these were found in open-source projects where it's less clear how widely deployed they are. For some like Sancus and Keystone, it's clear these are only research prototypes and no real-world impact. However, for others like Graphene and LKL it's less clear," Van Bulck told us, when we asked why the other vulnerabilities didn't receive a CVE.<br/><br/>"There's also one vulnerability in an SGX backend for the official Rust compiler, which is a more subtle to exploit but still considered quite dangerous."</p>
      <figure>
        <img src="https://zdnet4.cbsistatic.com/hub/i/2019/11/12/e1a38bd4-7ba1-4283-bd04-0683c826dc67/a9060e19ed5038505205b9b29679c04c/tee-sdk-attacks.png"/>
        <figcaption>Image: Van Bulck et al.</figcaption>
      </figure>
      <p>All issues were reported to their respective SDK vendors earlier this year, and the research team said they worked with the project maintainers to fix all vulnerabilities.<br/><br/>"In each case, the issues have been verified and acknowledged by the developers. In the case of Intel, this can be tracked via CVE-2018-3626 and CVE-2019-14565, and for Microsoft via CVE-2019-0876, CVE-2019-1369, and CVE-2019-1370," researchers said.<br/><br/>"The weakness found in Fortanix-EDP led to a security patch in the Rust compiler. For other open-source projects, our reports have been acknowledged in the respective commits or issues on GitHub," they also added.<br/><br/>The research team will be presenting their findings on Thursday, November 14, <a href="https://sigsac.org/ccs/CCS2019/index.php/program/program-2/#Thursday">at the ACM CCS 2019 conference</a>, held in London.<br/><br/>Following their presentation, proof-of-concept code to reproduce the vulnerabilities will be released <a href="https://github.com/jovanbulck/0xbadc0de">on GitHub</a>, along with a whitepaper, entitled "A Tale of Two Worlds: Assessing the Vulnerability of Enclave Shielding Runtimes."<br/><br/>Academics from the University of Birmingham, in the UK, and the Catholic University in Leuven (KU Leuven), Belgium, contributed to this research project.<br/><br/>Earlier this year, in August, some of the world's biggest tech companies, such as Alibaba, Arm, Baidu, Google Cloud, IBM, Intel, Microsoft, Red Hat, Swisscom, and Tencent, <a href="https://www.zdnet.com/article/intel-ibm-google-microsoft-others-join-new-security-focused-industry-group/">founded the Confidential Computing Consortium</a>, an industry group dedicated to improving and accelerate the adoption and broad use of secure enclaves.</p>
    </article>
  </body>
</html>