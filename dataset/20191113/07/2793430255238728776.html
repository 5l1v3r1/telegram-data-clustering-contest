<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://habr.com/en/company/microsoft/blog/475064/"/>
    <meta property="og:site_name" content="Habr"/>
    <meta property="article:published_time" content="2019-11-13T07:00:02+00:00"/>
    <meta property="og:title" content=".NET Core 3 for Windows Desktop"/>
    <meta property="og:description" content="In September, we released .NET Core support for building Windows desktop applications, including WPF and Windows Forms. Since then, we have been delighted to..."/>
  </head>
  <body>
    <article>
      <h1>.NET Core 3 for Windows Desktop</h1>
      <address><time datetime="2019-11-13T07:00:02+00:00">13 Nov 2019, 07:00</time> by <a rel="author" href="https://habr.com/en/users/msgeek/" target="_blank">msgeek</a></address>
      <p>In September, we released .NET Core support for building Windows desktop applications, including WPF and Windows Forms. Since then, we have been delighted to see so many developers share their stories of migrating desktop applications (and controls libraries) to .NET Core. We constantly hear stories of .NET Windows desktop developers powering their business with WPF and Windows Forms, especially in scenarios where the desktop shines, including:</p>
      <ul>
        <li>UI-dense forms over data (FOD) applications</li>
        <li>Responsive low-latency UI</li>
        <li>Applications that need to run offline/disconnected</li>
        <li>Applications with dependencies on custom device drivers</li>
      </ul>
      <p>This is just the beginning for Windows application development on .NET Core. Read on to learn more about the benefits of .NET Core for building Windows applications.</p>
      <figure>
        <img src="https://habrastorage.org/webt/zr/wf/ns/zrwfnstt7l3hyx-pzo_8bexswbu.png"/>
      </figure>
      <h3>Why Windows desktop on .NET Core?</h3>
      <p>.NET Core (and in the future .NET 5 that is built on top of .NET Core) will be the future of .NET. We are committed to support .NET Framework for years to come, however it will not be receiving any new features, those will only be added to .NET Core (and eventually .NET 5). To improve Windows desktop stacks and enable .NET desktop developers to benefit from all the updates of the future, we brought Windows Forms and WPF to .NET Core. They will still remain Windows-only technologies because there are tightly coupled dependencies to Windows APIs. But .NET Core, besides being cross-platform, has many other features that can enhance desktop applications.<br/><br/>First of all, all the runtime improvements and language features will be added only to .NET Core and in the future to .NET 5. A good example here is C# 8 that became available in .NET Core 3.0. Besides, the .NET Core versions of Windows Forms and WPF will become a part of the .NET 5 platform. So, by porting your application to .NET Core today you are preparing them for .NET 5.<br/><br/>Also, .NET Core brings deployment flexibility for your applications with new options that are not available in .NET Framework, such as:</p>
      <ul>
        <li>Side-by-side deployment. Now you can have multiple .NET Core versions on the same machine and can choose which version each of your apps should target.</li>
        <li>Self-contained deployment. You can deploy the .NET Core platform with your applications and become completely independent of your end users environment – your app has everything it needs to run on any Windows machine.</li>
        <li>Smaller app sizes. In .NET Core 3 we introduced a new feature called linker (also sometimes referred to as trimmer), that will analyze your code and include in your self-contained deployment only those assemblies from .NET Core that are needed for your application. That way all platform parts that are not used for your case will be trimmed out.</li>
        <li>Single .exe files. You can package your app and the .NET Core platform all in one .exe file.</li>
        <li>Improved runtime performance. .NET Core has many performance optimizations compared to .NET Framework. When you think about the history of .NET Core, built initially for web and server workloads, it helps to understand if your application may see noticeable benefits from the runtime optimizations. Specifically, desktop applications with heavy dependencies on File I/O, networking, and database operations will likely see improvements to performance <i>for those scenarios</i>. Some areas where you may not notice much change are in UI rendering performance or application startup performance.</li>
      </ul>
      <p>By setting the properties <code>&lt;PublishSingleFile&gt;</code>, <code>&lt;RuntimeIdentifier&gt;</code> and <code>&lt;PublishTrimmed&gt;</code> in the publishing profile you’ll be able to deploy a trimmed self-contained application as a single .exe file as it is shown in the example below.</p>
      <pre>&lt;PropertyGroup&gt;<br/>    &lt;OutputType&gt;Exe&lt;/OutputType&gt;<br/>    &lt;TargetFramework&gt;netcoreapp3.0&lt;/TargetFramework&gt;<br/>    &lt;PublishSingleFile&gt;true&lt;/PublishSingleFile&gt;<br/>    &lt;RuntimeIdentifier&gt;win-x64&lt;/RuntimeIdentifier&gt;<br/>    &lt;PublishTrimmed&gt;true&lt;/PublishTrimmed&gt;<br/>&lt;/PropertyGroup&gt;</pre>
      <h3>Differences between .NET Framework desktop and .NET Core desktop</h3>
      <p>While developing desktop applications, you won’t notice much difference between .NET Framework and .NET Core versions of WPF and Windows Forms. A part of our effort was to provide a functional parity between these platforms in the desktop area and enhance the .NET Core experience in the future. WPF applications are fully supported on .NET Core and ready for you to use, while we are working on minor updates and improvements. For Windows Forms the runtime part is fully ported to .NET Core and the team is working on the Windows Forms Designer. We are planning to get it ready by the fourth quarter of 2020 and for now you can check out the Preview version of the designer in <a href="https://visualstudio.microsoft.com/vs/preview/">Visual Studio</a> 16.4 Preview 3 or later. Don’t forget to set the checkbox in the Tools-&gt;Options-&gt;Preview Features-&gt;Use the Preview of Windows Forms designer for .NET Core apps and restart the Visual Studio. Please keep in mind that the experience is limited for now since the work on it is in progress.</p>
      <h4>Breaking changes</h4>
      <p>There are a few <a href="https://docs.microsoft.com/dotnet/core/compatibility/framework-core">breaking changes</a> between .NET Framework and .NET Core but most of the code related to Windows Forms and WPF areas was ported to Core as-is. If you were using such components as WCF Client, Code Access Security, App Domains, Interop and Remoting, you will need to refactor your code if you want to switch to .NET Core.<br/><br/>Another thing to keep in mind – the default output paths on .NET Core is different from on .NET Framework, so if you have some assumptions in your code about file/folder structure of the running app then it’ll probably fail at runtime.<br/><br/>Also, there are changes in how you configure the .NET features. .NET Core instead of <code>machine.config</code> file uses <code>&lt;something&gt;.runtimeconfig.json</code> file that comes with an application and has the same general purpose and similar information. Some configurations such as <code>system.diagnostics</code>, <code>system.net</code>, or <code>system.servicemodel</code> are not supported, so an app config file will fail to load if it contains any of these sections. This change affects <code>System.Diagnostics</code> tracing and WCF client scenarios which were commonly configured using XML configuration previously. In .NET Core you’ll need to configure them in code instead. To change behaviors without recompiling, consider setting up tracing and WCF types using values loaded from a <code>Microsoft.Extensions.Configuration</code> source or from <code>appSettings</code>.<br/><br/>You can find more information on differences between .NET Core and .NET Framework in the <a href="https://docs.microsoft.com/dotnet/core/porting/net-framework-tech-unavailable">documentation</a>.</p>
      <h3>Getting Started</h3>
      <p>Check out these short video tutorials:</p>
      <ul>
        <li>
          <a href="https://www.youtube.com/watch?v=Y4pthq_zGvI&amp;list=PLdo4fOcmZ0oV7n106SEWwWPy4WVjpl3Fj&amp;index=4&amp;t=6s">Getting started with WPF on .NET Core</a>
        </li>
        <li>
          <a href="https://www.youtube.com/watch?v=a66wsCRSgDk&amp;list=PLdo4fOcmZ0oV7n106SEWwWPy4WVjpl3Fj&amp;index=3&amp;t=12s">Getting started with Windows Forms on .NET Core</a>
        </li>
        <li>
          <a href="https://www.youtube.com/watch?v=BPWTdQ7rh2w&amp;list=PLdo4fOcmZ0oV7n106SEWwWPy4WVjpl3Fj&amp;index=2&amp;t=67s">Differences between .NET Core and .Net Framework and what to choose for your application</a>
        </li>
      </ul>
      <h3>Porting from .NET Framework to .NET Core</h3>
      <p>First of all, run the <a href="https://github.com/Microsoft/dotnet-apiport-ui/releases/download/1.1/PortabilityAnalyzer.zip">Portability Analyzer</a> and if needed, update your code to get a 100% compatibility with .NET Core. Here are <a href="https://devblogs.microsoft.com/dotnet/are-your-windows-forms-and-wpf-applications-ready-for-net-core-3-0/">instructions on using the Portability Analyzer</a>. We recommend to use a source control or to backup your code before you make any changes to your application in case the refactoring would not go the way you want, and you decide to go back to your initial state.<br/><br/>When your application is fully compatible with .NET Core, you are ready to port it. As a starting point, you can try out a tool we created to help automate converting your .NET Framework project(s) to .NET Core – <a href="https://github.com/dotnet/try-convert">try-convert</a>.<br/><br/>It’s important to remember that this tool is just a starting point in your journey to .NET Core. It is also not a supported Microsoft product. Although it can help you with some of the mechanical aspects of migration, it will not handle all scenarios or project types. If your solution has projects that the tool rejects or fails to convert, you’ll have to port by hand. No worries, we have plenty of tutorials on how to do it (in the end of this section).<br/><br/>The try-convert tool will attempt to migrate your old-style project files to the new SDK-style and retarget applicable projects to .NET Core. For your libraries we leave it up to you to make a call regarding the platform: weather you’d like to target .NET Core or .NET Standard. You can specify it in your project file by updating the value for <code>&lt;TargetFramework&gt;</code>. Libraries without .NET Core-specific dependencies like WPF or Windows Forms may benefit from targeting .NET Standard:</p>
      <pre>&lt;TargetFramework&gt;netstandard2.1&lt;/TargetFramework&gt;</pre>
      <p>so that they can be used by callers targeting many different .NET Platforms. On the other hand, if a library uses a feature that requires .NET Core (like Windows desktop UI APIs), it’s fine for the library to target .NET Core:</p>
      <pre>&lt;TargetFramework&gt;netcoreapp3.0&lt;/TargetFramework&gt;</pre>
      <p>try-convert is a global tool that you can <a href="https://github.com/dotnet/try-convert/releases">install</a> on your machine, then you can call from CLI:</p>
      <pre>C:\&gt; try-convert -p &lt;path to your project&gt;</pre>
      <p>or</p>
      <pre>C:\&gt; try-convert -w &lt;path to your solution&gt;</pre>
      <p>As previously mentioned, if the try-convert tool did not work for you, here are materials on how to port your application by hand.<br/><br/><b>Videos</b></p>
      <ul>
        <li>
          <a href="https://sec.ch9.ms/ch9/beca/05683ec4-e8f8-4415-9009-046352a4beca/on.NET_porting_high.mp4">Simple porting case</a>
        </li>
        <li>
          <a href="https://www.youtube.com/playlist?list=PLReL099Y5nRdG-LQ6OZSPECF-eXjgFNrW">Advanced porting case</a>
        </li>
      </ul>
      <p>
        <b>Documentation</b>
      </p>
      <ul>
        <li>
          <a href="https://devblogs.microsoft.com/dotnet/porting-desktop-apps-to-net-core/">Simple porting case</a>
        </li>
        <li>Advanced porting case (<a href="https://devblogs.microsoft.com/dotnet/migrating-a-sample-wpf-app-to-net-core-3-part-1/">Part 1</a>, <a href="https://devblogs.microsoft.com/dotnet/migrating-a-sample-wpf-app-to-net-core-3-part-2/">Part 2</a>)</li>
        <li>
          <a href="https://docs.microsoft.com/en-us/dotnet/core/porting/">Overview of the porting process</a>
        </li>
      </ul>
      <related>
        <h4>Similar posts</h4>
        <a href="https://habr.com/en/post/447462/"/>
        <a href="https://habr.com/en/post/446508/"/>
        <a href="https://habr.com/en/post/444010/"/>
      </related>
    </article>
  </body>
</html>