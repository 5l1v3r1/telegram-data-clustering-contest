<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://dtf.ru/gamedev/82398-kak-mashinnoe-obuchenie-mozhet-pomoch-pri-analize-povedeniya-igrokov"/>
    <meta property="og:site_name" content="DTF"/>
    <meta property="article:published_time" content="2019-11-21T12:40:36+00:00"/>
    <meta property="og:title" content="Как машинное обучение может помочь при анализе поведения игроков"/>
    <meta property="og:description" content="Практический пример на основе матчей NHL."/>
  </head>
  <body>
    <article>
      <h1>Как машинное обучение может помочь при анализе поведения игроков</h1>
      <address><time datetime="2019-11-21T12:40:36+00:00">21 Nov 2019, 12:40</time> by <a rel="author">Владимир Семыкин</a></address>
      <p>Практический пример на основе матчей NHL.</p>
      <p>Data scientist из Zynga Бен Вебер на сайте Gamasutra опубликовал <a href="https://www.gamasutra.com/blogs/BenWeber/20191114/353773/Automating_Machine_Learning_for_MobileGames.php">текст</a> о попытке создать метод анализа на основе машинного обучения, который позволит собирать информацию о результатах игровых сессий и соединять их в понятную структуру. Бен показал результаты своей работы на примере датасета о ключевых моментах из матчей NHL. По словам исследователя, этот подход можно применять для анализа поведения в мобильных играх.</p>
      <figure>
        <img src="https://leonardo.osnova.io/2914c7ef-ceba-2d40-daf3-9325064bfe44/"/>
      </figure>
      <p>Одна из главных проблем в работе машинного обучения — определение того, какие входные данные обеспечивают наилучшие сигналы для обучения прогнозных моделей. Для графических данных и других неструктурированных форматов модели глубокого обучения демонстрируют значительные улучшения по сравнению с предыдущими подходами. Но для данных, уже представленных в структурированных форматах, преимущества менее очевидны.</p>
      <p>По словам разработчика, он использует библиотеку Featuretools, чтобы значительно сократить время на построение прогностических моделей, и это открывает новый класс проблем для специалистов по data science. Вместо построения прогнозных моделей для отдельных игр и конкретных ответов, сейчас создаются пайплайны машинного обучения, которые могут быть применены к широкому набору проблем.</p>
      <p>Автоматизированное <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%B8%D0%B7%D0%BD%D0%B0%D0%BA%D0%BE%D0%B2">конструирование признаков</a> — это процесс создания векторов из тысяч или даже миллионов точек данных для каждого пользователя. Такой подход вдохновлён методами синтеза признаков из глубокого обучения, но фокусируется только на этапе генерации признаков, а не на подгонке модели.</p>
      <p>В результате глубокого синтеза признаков можно перевести тысячи записей, описывающих действия пользователя, в одну, которую можно использовать для обучения моделей. Есть множество примеров использования машинного обучения, и Бен описал несколько из них.</p>
      <p><mark>Модели склонностей (Propensity Models): какие действия выполняют пользователи?</mark> Прогнозирование вероятных действий пользователей полезно для персонализации игрового процесса. Бен использовал библиотеку Featuretools, чтобы автоматизировать разработку признаков для построения моделей склонностей во всех играх Zynga.</p>
      <figure>
        <img src="https://leonardo.osnova.io/52a6b892-4209-b38e-6f36-95c88fb35fdf/"/>
      </figure>
      <p><mark>Рекомендации: какие действия должны быть предписаны?</mark> Коллаборативная фильтрация — это ценный инструмент, чтобы предложить игрокам персонализированный контент. Вместо использования перечня прошлых покупок в качестве вектора функций для коллаборативной фильтрации, Бен изучил некоторые прокси-переменные.</p>
      <figure>
        <img src="https://leonardo.osnova.io/aed5df76-3693-e30a-c65b-ec8ae145f88b/"/>
      </figure>
      <p><mark>Сегментация: как нужно персонализировать пользовательский опыт?</mark> Сегментация — один из ключевых результатов, который может предложить аналитическая группа. Если вы можете понять поведение различных групп пользователей в продукте, то вы можете предложить персонализированный подход для улучшения взаимодействия с вашей базой пользователей.</p>
      <figure>
        <img src="https://leonardo.osnova.io/2e35ed50-1101-4215-b080-d58a7e0d4461/"/>
      </figure>
      <p><mark>Обнаружение аномалий: какие пользователи дают плохой результат?</mark> В любой онлайн-среде есть плохие акторы. Бен вместе с командой пробовал применить глубокое обучение для решения этой проблемы. С помощью автокодирования на сгенерированных наборах признаков им удалось создать инструмент для маркировки проблемных пользователей.</p>
      <figure>
        <img src="https://leonardo.osnova.io/1e765e40-e434-f481-147b-ebc43bda8670/"/>
      </figure>
      <p>Разработка признаков — один из основных этапов в рабочем процессе машинного обучения, где необработанные данные преобразуются в «резюме» по игроку. Такие сводки могут использоваться в качестве входных данных для контролируемых и неконтролируемых алгоритмов обучения.</p>
      <p>Бен привёл пример того, как его команда выполняет этот шаг, используя примеры данных из датасета <a href="https://www.kaggle.com/martinellis/nhl-game-data">NHL Kaggle</a>, в котором собраны детализированные игровые события за последние двадцать лет профессиональных хоккейных матчей.</p>
      <p>Бен использует Python для большинства анализов и PySpark для масштабирования пайплайнов машинного обучения. Главная задача в таких пайплайнах — это извлечение данных из хранилища. Обычно разработчики получают данные из «озера данных» на S3, но в этом примере будут использоваться локальные файлы, загруженные из датасета Kaggle. В приведённом ниже фрагменте кода Python показано, как загрузить эти файлы в виде датафреймов Pandas и удалить посторонние столбцы.</p>
      <p># load CSV files into Pandas data frames import pandas as pd game_df = pd.read_csv("game.csv") plays_df = pd.read_csv("game_plays.csv") # clean up the data frame and show the results plays_df = plays_df.drop(['secondaryType', 'periodType', 'dateTime', 'rink_side'], axis=1).fillna(0) plays_df.head()</p>
      <p>Датафрейм game_df предоставляет сводки хоккейных матчей, в то время как датафрейм plays_df содержит подробные игровые события, такие как вбрасывания и броски. Последняя команда в приведённом выше фрагменте отображает первые пять игровых записей.</p>
      <figure>
        <img src="https://leonardo.osnova.io/b5b01ac6-43c8-144f-ae48-676cea791cff/"/>
        <figcaption>Вот эти записи</figcaption>
      </figure>
      <p>Цель Бена и его команды состоит в том, чтобы перевести детализированные события из узкого и глубокого формата в мелкий и широкий, где одна строка содержит сотни столбцов и результатов одной игры. Чтобы выполнить этот процесс, они используют двухэтапное преобразование, в котором сначала кодируют набор столбцов, а затем выполняют глубокий синтез функций на датафреймах с результатами.</p>
      <p>Например, для датасета NHL нужно закодировать столбцы «events» и «description». Featuretools предоставляет функцию encode_features для преобразования столбцов со многими возможными значениями в фиктивные столбцы с двоичными значениями. Прежде чем использовать эту функцию, нужно закодировать датафрейм plays как множество сущностей, которое предоставляет метаданные о датафреймах библиотеке Featuretools.</p>
      <p>Во фрагменте кода ниже показано, как создать множество сущностей для датафрейма plays; указать, какие столбцы являются категориальными; закодировать столбцы «events» и «description». Результатом является более широкий фрейм данных с фиктивными переменными для этих столбцов.</p>
      <p># load the featuretools library import featuretools as ft from featuretools import Feature # create an entity set and list the categorical variables es = ft.EntitySet(id="plays") es = es.entity_from_dataframe(entity_id="plays", dataframe=plays_df ,index="play_id", variable_types = { "event": ft.variable_types.Categorical, "description": ft.variable_types.Categorical }) # one-hot encode the features and show the results f1 = Feature(es["plays"]["event"]) f2 = Feature(es["plays"]["description"]) encoded, defs = ft.encode_features(plays_df, [f1, f2], top_n=10) encoded.head()</p>
      <p>Выходные данные этого фрагмента показаны в таблице ниже. Датафрейм содержит то же количество записей, что и раньше, но теперь в нём 36, а не 18 столбцов.</p>
      <figure>
        <img src="https://leonardo.osnova.io/7ca7d784-99bf-e185-2eaf-0f1943c46556/"/>
      </figure>
      <p>Теперь можно выполнить глубокий синтез функций с помощью функции dfs в Featuretools. В приведённом ниже фрагменте кода показано, как преобразовать датафрейм с фиктивными переменными в множество сущностей, а затем нормализовать его. Функция normalize_entity указывает, что записи игр должны быть сгруппированы в наборы с помощью столбца game_id. После запуска dfs на результирующем множестве сущностей получится датафрейм с одной записью на игру и сотнями столбцов, описывающих действия в матче.</p>
      <p># create an entity set from the one-hot encoding es = ft.EntitySet(id="plays") es = es.entity_from_dataframe(entity_id="plays", dataframe=encoded, index="play_id") # group play events into sets of games es = es.normalize_entity(base_entity_id="plays", new_entity_id="games", index="game_id") # perform feature synthesis and show the results features,transform=ft.dfs(entityset=es, target_entity="games",max_depth=2) features.head(2)</p>
      <p>Результирующий датафрейм со сгенерированными функциями показан в таблице ниже. Датафрейм plays теперь состоит не из 36 столбцов, а переведён в датафрейм game summary с более чем 200 столбцами.</p>
      <figure>
        <img src="https://leonardo.osnova.io/9951e1d4-215d-513b-4333-23c7711ba5f1/"/>
      </figure>
      <p>Этот способ помогает автоматизировать большую часть процесса сбора информации о поведении пользователей. Здесь был рассмотрен пример с игровыми данными NHL, но тот же процесс может быть применён к отслеживанию событий для мобильных игр. Полный код примера доступен на <a href="https://github.com/bgweber/StartupDataScience/blob/master/EDA/NHL_Games.ipynb">GitHub</a>.</p>
    </article>
  </body>
</html>