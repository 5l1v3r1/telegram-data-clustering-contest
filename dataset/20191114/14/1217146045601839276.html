<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://www.bleepingcomputer.com/news/security/symantec-fixes-privilege-escalation-flaw-in-endpoint-protection/"/>
    <meta property="og:site_name" content="BleepingComputer"/>
    <meta property="article:published_time" content="2019-11-14T14:16:54+00:00"/>
    <meta property="og:title" content="Symantec Fixes Privilege Escalation Flaw in Endpoint Protection"/>
    <meta property="og:description" content="Symantec fixed a local privilege escalation security flaw affecting all Symantec Endpoint Protection software versions prior to 14.2 RU2, and allowing attackers to escalate privileges on compromised devices and execute malicious code using SYSTEM privileges."/>
  </head>
  <body>
    <article>
      <h1>Symantec Fixes Privilege Escalation Flaw in Endpoint Protection</h1>
      <address><time datetime="2019-11-14T14:16:54+00:00">14 Nov 2019, 14:16</time> by <a rel="author" href="https://www.bleepingcomputer.com/author/sergiu-gatlan/" target="_blank">Sergiu Gatlan</a></address>
      <figure>
        <img src="https://www.bleepstatic.com/content/hl-images/2017/03/27/SymantecLogo.jpg"/>
      </figure>
      <p>Symantec fixed a local privilege escalation security flaw affecting all Symantec Endpoint Protection software versions prior to 14.2 RU2, and allowing attackers to escalate privileges on compromised devices and execute malicious code using SYSTEM privileges.</p>
      <p><a href="https://www.symantec.com/products/endpoint">Symantec Endpoint Protection</a> is a suite of security solutions including intrusion prevention, firewall, data loss prevention, and anti-malware capabilities for both desktop and server computers.</p>
      <h3>Not the first LPE bug reported to security vendors</h3>
      <p>This is not the first local privilege escalation security issue reported to a security vendor this year by SafeBreach Labs security researcher Peleg Hadar, the one who also discovered the Symantec Endpoint Protection LPE. </p>
      <p>Since August, Hadar also found other similar issues impacting <a href="https://www.bleepingcomputer.com/news/security/trend-micro-fixes-privilege-escalation-bug-in-password-manager/">Trend Micro's Password Manager</a>, <a href="https://www.bleepingcomputer.com/news/security/check-point-patches-privilege-escalation-flaw-in-endpoint-client/">Check Point Software's Endpoint Security Initial Client</a>, <a href="https://www.bleepingcomputer.com/news/security/bitdefender-fixes-privilege-escalation-bug-in-free-antivirus-2020/">the free version of Bitdefender Antivirus</a>, <a href="https://safebreach.com/Post/Avira-Antivirus-2019-4-Services-DLL-Preloading-and-Potential-Abuses-CVE-2019-17449">Avira's Antivirus 2019 software</a>, <a href="https://safebreach.com/Post/Avast-Antivirus-AVG-Antivirus-DLL-Preloading-into-PPL-and-Potential-Abuses">Avast Software's AVG Antivirus and Avast Antivirus</a>, and <a href="https://www.bleepingcomputer.com/news/security/mcafee-patches-privilege-escalation-flaw-in-antivirus-software/">several McAfee Antivirus software solutions</a>.</p>
      <p>Each of them could enable hackers to exploit systems running the unpatched versions to drop and execute malicious payloads in a persistent way, as well as to evade detection during later stages of an attack.</p>
      <p>Trend Micro, Check Point Software, Bitdefender, Avast, and McAfee patched the security flaws (tracked as CVE-2019-14684, CVE-2019-8461, CVE-2019-15295, CVE-2019-17449, CVE-2019-17093, and CVE-2019-3648) after receiving the researcher's disclosure report, with users receiving the updates via the automatic update features built within the security apps.</p>
      <h3>Privilege escalation flaw fixed by Symantec</h3>
      <p>The Symantec Endpoint Protection LPE bug now tracked as <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12758">CVE-2019-12758</a> requires potential attackers to have Administrator privileges to successfully exploit the issue to Hadar.</p>
      <p>While the threat level of this vulnerability is not immediately apparent, such bugs are commonly rated with medium and high severity CVSS 3.x base scores [<a href="https://nvd.nist.gov/vuln/detail/CVE-2019-17093">1</a>, <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-17093">2</a>].</p>
      <p>Hackers abuse DLL search-order hijacking issues such as this as part multi-stage attacks after infiltrating a target's machine to elevate permissions to further compromise the device and to establish persistence.</p>
      <p>Upon successful exploitation, it can be used "to bypass Symantec’s Self-Defense mechanism and achieve defense evasion, persistence and privilege escalation by loading an arbitrary unsigned DLL into a process that is signed by Symantec and that runs as NT AUTHORITY\SYSTEM.," <a href="https://safebreach.com/Post/Symantec-Endpoint-Protection-Self-Defense-Bypass-and-Potential-Usages-CVE-2019-12758">Hadar says</a>.</p>
      <p>Symantec addressed the LPE vulnerability in the Symantec Endpoint Protection 14.2 RU2 <a href="https://support.symantec.com/us/en/article.tech154475.html">release</a> issued on October 22, 2019.</p>
      <h3>Arbitrary unsigned DLL loading from CWD</h3>
      <p>Hadar says that CVE-2019-12758 is caused by the security solution's attempt to load a DLL from its current working directory (CWD) instead of the DLL's actual location and by not validating if the DLLs is signed with a digital certificate.</p>
      <p>The researcher found that the Symantec SepMasterService service running as a signed process as NT AUTHORITY\SYSTEM attempts to import the DSPARSE.dll from its CWD, the C:\Windows\SysWow64\Wbem directory, instead of its actual location, in the SysWow64 folder.</p>
      <p>By exploiting this bug, one could load an arbitrary unsigned DLL into the SepMasterService processes if one already has Administrator privileges on the system, thus bypassing Symantec Endpoint Protection's self-defense mechanism.</p>
      <p>Hadar implanted an unsigned 32-bit proxy DLL in the SysWow64\Wbem​​​​​​​ folder as part of a proof-of-concept (Poc) demonstration, loaded it, and executed it within a Symantec Corporation signed processes as NT AUTHORITY\SYSTEM, circumventing the self-defense mechanism of the Symantec Endpoint Protection's just as expected.</p>
      <figure>
        <img src="https://www.bleepstatic.com/images/news/u/1109292/November%202019/Proof%20of%20concept(1).png"/>
        <figcaption>Proof of concept <i>(SafeBreach Labs)</i></figcaption>
      </figure>
      <p>"The vulnerability gives attackers the ability to load and execute malicious payloads within the context of a Symantec’s signed process," Hadar states.</p>
      <p>"This ability might be abused by an attacker for different purposes such as execution and evasion, for example: Application Whitelisting Bypass. The Antivirus might not detect the attacker’s binary, because it tries to load it without any verification against it."</p>
      <p>Exploiting the CVE-2019-12758​​​​​​​ bug on machines running vulnerable versions of Symantec Endpoint Protection could also make it possible for attackers to load and launch malicious code every time the Symantec services are loaded on the system, gaining persistence between system reboots.</p>
      <p>More info on how the LPE flaw was discovered, a comprehensive analysis of its root cause, and a complete disclosure timeline are available at the end of the Hadar's report.</p>
    </article>
  </body>
</html>