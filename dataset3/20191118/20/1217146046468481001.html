<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://www.bleepingcomputer.com/news/security/buran-ransomware-infects-pcs-via-microsoft-excel-web-queries/"/>
    <meta property="og:site_name" content="BleepingComputer"/>
    <meta property="article:published_time" content="2019-11-18T20:36:03+00:00"/>
    <meta property="og:title" content="Buran Ransomware Infects PCs via Microsoft Excel Web Queries"/>
    <meta property="og:description" content="A new spam campaign has been spotted distributing the Buran Ransomware through IQY file attachments. When opened, these Microsoft Excel Web Query attachments will execute a remote command that installs the ransomware onto a victim's computer."/>
  </head>
  <body>
    <article>
      <h1>Buran Ransomware Infects PCs via Microsoft Excel Web Queries</h1>
      <address><time datetime="2019-11-18T20:36:03+00:00">18 Nov 2019, 20:36</time> by <a rel="author" href="https://www.bleepingcomputer.com/author/lawrence-abrams/" target="_blank">Lawrence Abrams</a></address>
      <figure>
        <img src="https://www.bleepstatic.com/content/hl-images/2019/04/26/Malspam.jpg"/>
      </figure>
      <p>A new spam campaign has been spotted distributing the Buran Ransomware through IQY file attachments. When opened, these Microsoft Excel Web Query attachments will execute a remote command that installs the ransomware onto a victim's computer.</p>
      <p>A new malspam campaign was discovered by security researcher <a href="https://twitter.com/killamjr/status/1195821676824604672">Suspicious Link</a> that pretends to be a simple fwd of a previous email stating that the user should "Print document in attach". </p>
      <figure>
        <img src="https://www.bleepstatic.com/images/news/ransomware/b/buran/iqy-distribution/malspam.jpg"/>
        <figcaption>Malspam Email</figcaption>
      </figure>
      <p>This attached document is an IQY file that when opened will execute a web query, or remote command, given by a remote server that uses PowerShell to install the Buran Ransomware.</p>
      <p>For those who are not familiar with IQY files, they are Excel Web Query documents that when opened will attempt to import data into a worksheet using external sources.  For example, as shown below, the attached IQY file is simply a text file that specifies its data will come from the web and be retrieved from the listed URL.</p>
      <figure>
        <img src="https://www.bleepstatic.com/images/news/ransomware/b/buran/iqy-distribution/iqy-file.jpg"/>
        <figcaption>IQY Attachment</figcaption>
      </figure>
      <p>The problem is that the data returned from an external source can also be an formula that is then executed by Excel when the IQY file is opened. In this particular case, the formula will launch a PowerShell command that downloads a remote Buran Ransomware executable named 1.exe, saves it to the Temp folder, and then executes it.</p>
      <figure>
        <img src="https://www.bleepstatic.com/images/news/ransomware/b/buran/iqy-distribution/command-to-execute.jpg"/>
        <figcaption>Remote command to execute</figcaption>
      </figure>
      <p>Like malicious macros, users first need to enable the data source, but as we have seen with other spam campaigns, too many people blindly click on the Enable button.</p>
      <figure>
        <img src="https://www.bleepstatic.com/images/news/ransomware/b/buran/iqy-distribution/iqy-file-in-excel.jpg"/>
        <figcaption>IQY File in Excel</figcaption>
      </figure>
      <p>If the user clicks on Enable, the 1.exe file will be downloaded and executed, which will start to encrypt the files on the computer.</p>
      <figure>
        <img src="https://www.bleepstatic.com/images/news/ransomware/b/buran/iqy-distribution/encrypted-files.jpg"/>
        <figcaption>Buran Encrypted Files</figcaption>
      </figure>
      <p>In each folder that files are encrypted, a ransom note named <b>!!! ALL YOUR FILES ARE ENCRYPTED !!!.TXT</b> will be created that tells a victim to contact either stopcrypt@cock.email or decryptor@cock.email for payment instructions.</p>
      <figure>
        <img src="https://www.bleepstatic.com/images/news/ransomware/b/buran/iqy-distribution/ransom-note.jpg"/>
        <figcaption>Buran Ransom Note</figcaption>
      </figure>
      <p>I find it ironic how ransomware attackers offer this warning to watch out for scammers (they aren't wrong!) who try to scam victims with fake decryption promises:</p>
      <p>"Decryption of your files with the help of third parties may cause increased price (they add their fee to our) or you can become a victim of a scam."</p>
      <p>Unfortunately, at this time there is no way to decrypt files encrypted by Buran for free.</p>
      <h3>Users should block IQY files</h3>
      <p>This is not the first time we have seen malicious email campaigns utilizing IQY files to install malware.</p>
      <p>In 2018, we also saw Web Queries being <a href="https://www.bleepingcomputer.com/news/security/malspam-campaigns-using-iqy-attachments-to-bypass-av-filters-and-install-rats/">used to install RATs</a> such as the  AMMYY Admin program and also the Marap and Quant Loader malware in a <a href="https://www.bleepingcomputer.com/news/security/necurs-spews-780-000-emails-with-weaponized-iqy-files/">Necurs campaign</a>.</p>
      <p>Due to their ability to execute almost any command on a victim's computer, Microsoft has blocked IQY files through Outlook on the Web and made it possible to block untrusted Microsoft Query IQY files in Windows <a href="https://www.bleepingcomputer.com/news/microsoft/office-365-admins-can-now-block-malicious-microsoft-query-iqy-files/">through group policies</a>.</p>
      <p>Users can also block IQY files on their own, without an admin's help, by following these commands in Excel:</p>
      <p>• In Excel, click the <b>File </b>tab.<br/>• Click <b>Options </b>&gt;<b> Trust Center</b> &gt; <b>Trust Center Settings</b>, and then click <b>External Content</b>.<br/>• Check the 'A<b>lways block the connection of untrusted Microsoft Query files (.iqy, .oqy, .dqy, and .rqy)' option</b></p>
      <p>Unless you specifically need access to these types of files, it is strongly advised that you block Excel Web Queries via GPO or the above steps.</p>
    </article>
  </body>
</html>