<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://habr.com/en/post/476508/"/>
    <meta property="og:site_name" content="Habr"/>
    <meta property="article:published_time" content="2019-11-19T12:33:21+00:00"/>
    <meta property="og:title" content="PHP Microservice Framework: Swoft v2.0.7 Release on schedule"/>
    <meta property="og:description" content="What is Swoft? Swoft is a PHP high performance microservice coroutine framework. It has been published for many years and has become the best choice for php."/>
  </head>
  <body>
    <article>
      <h1>PHP Microservice Framework: Swoft v2.0.7 Release on schedule</h1>
      <address><time datetime="2019-11-19T12:33:21+00:00">19 Nov 2019, 12:33</time> by <a rel="author" href="https://habr.com/en/users/stelin/" target="_blank">stelin</a></address>
      <figure>
        <img src="https://habrastorage.org/webt/af/1b/wa/af1bwakekcb6gyzovkik_yw_pjo.jpeg"/>
      </figure>
      <h3>What is Swoft?</h3>
      <p>Swoft is a PHP high performance microservice coroutine framework. It has been published for many years and has become the best choice for php. It can be like Go, built-in coroutine web server and common coroutine client and is resident in memory, independent of traditional PHP-FPM. There are similar Go language operations, similar to the Spring Cloud framework flexible annotations.</p>
      <p>Through three years of accumulation and direction exploration, Swoft has made Swoft the Spring Cloud in the PHP world, which is the best choice for PHP's high-performance framework and microservices management.</p>
      <h3>Github</h3>
      <p>
        <a href="https://github.com/swoft-cloud/swoft">https://github.com/swoft-cloud/swoft</a>
      </p>
      <h3>Swoft v2.0.7</h3>
      <p>Swoft <code>v2.0.7</code> continues to sail on <code>v2.0.6</code> and has been used in a large number of production operations, which has been recognized and supported by many users. The official version has made a lot of improvements and optimizations, with better performance.</p>
      <ul>
        <li>Added Http Session function component, provides http session management, supports multiple storage drivers</li>
        <li>Enhanced TCP server request support to add global or corresponding method middleware</li>
        <li>Enhanced Websocket server message request support for adding global or corresponding method middleware</li>
      </ul>
      <h3>Http Session</h3>
      <p>Install the swoft/session component with Composer</p>
      <ul>
        <li>Execute <code>composer require swoft/session</code> in the directory where the project composer.json is located.</li>
        <li>Add <code>Swoft\Http\Session\SessionMiddleware</code> middleware to the global middleware</li>
      </ul>
      <p>In <code>app/bean.php</code>:</p>
      <pre>    'httpDispatcher'    =&gt; [<br/>        // Add global http middleware<br/>        'middlewares'      =&gt; [<br/>            \Swoft\Http\Session\SessionMiddleware::class,<br/>        ],<br/>    ],</pre>
      <blockquote>The default is based on local file drivers, saved in the <code>runtime/sessions</code> directory</blockquote>
      <p>More on the driver only need to configure the corresponding <code>handler</code>.<br/>For example, configure the <code>Redis</code> driver:</p>
      <pre>'sessionHandler' =&gt; [<br/>    'class'    =&gt; RedisHandler::class,<br/>    // Config redis pool<br/>    'redis' =&gt; bean('redis.pool')<br/>],</pre>
      <h3>Websocket Messaging Middleware</h3>
      <ul>
        <li>Global middleware</li>
      </ul>
      <p>Configured in <code>app/bean.php</code>:</p>
      <pre>    /** @see \Swoft\WebSocket\Server\WsMessageDispatcher */<br/>    'wsMsgDispatcher' =&gt; [<br/>        'middlewares' =&gt; [<br/>            \App\WebSocket\Middleware\GlobalWsMiddleware::class<br/>        ],<br/>    ],</pre>
      <ul>
        <li>Acting on the controller</li>
      </ul>
      <pre>/**<br/> * Class HomeController<br/> *<br/> * @WsController(middlewares={DemoMiddleware::class})<br/> */<br/>class TestController<br/>{}</pre>
      <h3>TCP Request Middleware</h3>
      <ul>
        <li>Global middleware</li>
      </ul>
      <p>Configured in <code>app/bean.php</code>:</p>
      <pre>    /** @see \Swoft\Tcp\Server\TcpDispatcher */<br/>    'tcpDispatcher' =&gt; [<br/>        'middlewares' =&gt; [<br/>            \App\Tcp\Middleware\GlobalTcpMiddleware::class<br/>        ],<br/>    ],</pre>
      <ul>
        <li>Acting on the controller</li>
      </ul>
      <pre>/**<br/> * Class DemoController<br/> *<br/> * @TcpController(middlewares={DemoMiddleware::class})<br/> */<br/>class DemoController<br/>{<br/>    // ....<br/>}</pre>
      <h3>Update Log</h3>
      <blockquote>Upgrade tips:<br/>   •  <code>Swoole\WebSocket\Server::push</code> The fourth parameter <code>$finish</code> was changed to int type after swoole <code>4.4.12</code>.<br/>   •  The <code>TcpServerEvent::CONNECT</code> event parameter of the tcp server remains the same as receive and close. <code>$fd, $server</code> swap positions.</blockquote>
      <h3>Github</h3>
      <p>
        <a href="https://github.com/swoft-cloud/swoft">https://github.com/swoft-cloud/swoft</a>
      </p>
      <p><b>Fixed</b>:</p>
      <ul>
        <li>When fixing config injection, if the value is not found, the default value of the corresponding type will be used to override the attribute, causing the default value of the attribute to be overwritten <a href="https://github.com/swoft-cloud/swoft-component/pull/522/commits/d84d50a76c4c7ff19dc0896868745cfe8f0d93c9">d84d50a7</a></li>
        <li>Fixed when using the message schedule in ws server, no empty data was filtered, resulting in one more response. Avoid method <a href="https://github.com/swoft-cloud/swoft/issues/1002">swoft-cloud/swoft#1002</a> [d84d50a7](<a href="https://github.com/swoft-cloud/swoft-component/">https://github.com/swoft-cloud/swoft-component/</a> Pull/522/commits/d84d50a76c4c7ff19dc0896868745cfe8f0d93c9)</li>
        <li>Fixed when using message scheduling in tcp server, no empty data was filtered, resulting in one more response. <a href="https://github.com/swoft-cloud/swoft-component/pull/522/commits/07a01ba1e6ff52baffbc7b2baf997e0e6a07ae04">07a01ba1</a></li>
        <li>Fixed missing swoft/stdlib library dependencies when using console component independently <a href="https://github.com/swoft-cloud/swoft-component/pull/529/commits/c569c81ae15c0b2b73db3a15c457d7b982a06d7f">c569c81a</a></li>
        <li>Fixed <code>ArrayHelper::get</code> When the input key is integer, the parameter parameter is incorrect <a href="https://github.com/swoft-cloud/swoft-component/pull/528/commits/a44dcad42cbdd20cb4078351a8deb3b966b1ca09">a44dcad</a></li>
        <li>Fix console rendering using table, when calculating int value, calculate width report type error <a href="https://github.com/swoft-cloud/swoft-component/pull/528/commits/74a835abd78ed58c081668129e723d5e83429398">74a835ab</a></li>
      </ul>
      <ul>
        <li>Fixed error in the component user can not customize the default error handling level <a href="https://github.com/swoft-cloud/swoft-component/pull/530/commits/4c78aeb3326bfb333227f07b675a2bdfc3b95f0f">4c78aeb</a></li>
        <li>Fix Enable and disable Component settings <code>isEnable()</code> does not work <a href="https://github.com/swoft-cloud/swoft-component/pull/530/commits/da8c51e561074f94ec29a8c5055f563c6ed13cc0">da8c51e56</a></li>
        <li>Fixes Using the <code>uniqid()</code> method in the cygwin environment must set the second parameter to true <a href="https://github.com/swoft-cloud/swoft-component/pull/530/commits/c7f688f4ef07bb7c7d59a0c03888d0c79f77d4c7">c7f688f</a></li>
        <li>Fixed Unable to set process title in cygwin environment and cause error <a href="https://github.com/swoft-cloud/swoft-component/pull/530/commits/c466f6a3841b6fb58e581d517c2151699ac4cf3e">c466f6a</a></li>
        <li>Fixed Unable to delete browser cookie data using http <code>response-&gt;delCookie()</code> <a href="https://github.com/swoft-cloud/swoft-component/pull/530/commits/8eb9241329e46dcab78e4f18ea4771808a1f034e">8eb9241</a></li>
        <li>Fixed ws server message dispatching, the received ext data is not necessarily an array causing an error <a href="https://github.com/swoft-cloud/swoft-component/pull/530/commits/ff45b356c709d97bc2937dab8d467e4680d58cf0">ff45b35</a></li>
        <li>Fix log file split by time <a href="https://github.com/swoft-cloud/swoft-component/pull/533/commits/08c42449cc5ca7922e5bf54d6523b0d8799ba910">c195413</a></li>
        <li>Fix the log <code>JSON</code> format small problem <a href="https://github.com/swoft-cloud/swoft-component/pull/535/commits/a3fc6b94a8afff873f7f3ac8248432ff2a409d13">a3fc6b9</a></li>
        <li>Fixed <code>rpc</code> service provider <code>getList</code> call twice <a href="https://github.com/swoft-cloud/swoft-component/pull/535/commits/fd03e71f525c265add11e9334cc6dd505daf62ec">fd03e71</a></li>
        <li>Fix <code>redis cluster</code> does not support <code>auth</code> parameter <a href="https://github.com/swoft-cloud/swoft-component/pull/525/commits/7a678fd866e3ec842b00f734f7f6c3b7b1a03a9b">7a678f</a></li>
        <li>Fix model query <code>json</code> type, does not support <code>array</code> <a href="https://github.com/swoft-cloud/swoft-component/pull/525/commits/6023a99aad06d9e87ff0a38bb4f37242f331a771">6023a9</a></li>
        <li>Fixed redis <code>multi</code> operation not connected in time <a href="https://github.com/swoft-cloud/swoft-component/pull/525/commits/e5f69802947ec3d9b56b7d56ec2dc4b1d70b4995">e5f698</a></li>
        <li>Fix redis does not support <code>expireAt</code>, <code>geoRadius</code> <a href="https://github.com/swoft-cloud/swoft-component/pull/525/commit/749241561dbb5a6b94c659b2642e255900cb6b69">749241</a></li>
        <li>Fixed <code>crontab</code> timestamp detection deviation problem <a href="https://github.com/swoft-cloud/swoft-ext/commit/eb08a46833188f49e05b1ea3c041c8a60ff53606">eb08a46</a></li>
      </ul>
      <p><b>Update(Update)</b>:</p>
      <ul>
        <li>Update console also emits an event before rendering the help message <code>ConsoleEvent::SHOW_HELP_BEFORE</code> <a href="https://github.com/swoft-cloud/swoft-component/pull/522/commits/d3f7bc3c5093a11a1de3710fd239c4375b835160">d3f7bc3</a></li>
        <li>Simplify and unify http, ws, tcp, rpc server management command logic <a href="https://github.com/swoft-cloud/swoft-component/pull/522/commits/f202c826b74972775fe97ad91b2c38e5c7d97014">f202c826</a></li>
        <li>Update the ws and tcp Connection classes to add the <code>newFromArray</code> and <code>toArray</code> methods to facilitate exporting information and restoring connections via third-party storage (<code>redis</code>) [a8b0b7c](<a href="https://github.com/swoft-cloud/swoft">https://github.com/swoft-cloud/swoft</a> -component/pull/528/commits/a8b0b7c77d56d4392eba75d13a911816b9dc0cee)</li>
        <li>Optimize server to add a unified swoole pipe message event handler, use the swowt event in ws, tcp to handle interprocess messages <a href="https://github.com/swoft-cloud/swoft-component/pull/530/commits/1c51a8c82357f52b6f858bcaa58396c521080695">1c51a8c</a></li>
      </ul>
      <p><b>Enhancement</b>:</p>
      <ul>
        <li>Now tcp requests support adding global or corresponding method middleware, and the process and usage are similar to http middleware. <i>Useful only when using system scheduling </i><a href="https://github.com/swoft-cloud/swoft-component/pull/528/commits/6b593877acc5cb78bbd863e08c0559454fb0b59c">6b593877</a></li>
        <li>Now the websocket message request supports adding global or corresponding method middleware, and the process and usage are similar to http middleware. <i>Useful only when using system scheduling</i> <a href="https://github.com/swoft-cloud/swoft-component/pull/530/commits/973981568df4bca18a4858efe1ef7730d903353e">9739815</a></li>
        <li>Event Management allows setting <code>destroyAfterFire</code> to clean up the data carried in the event after each event dispatch <a href="https://github.com/swoft-cloud/swoft-component/pull/530/commits/50bf43d39857fea7328c83a790c941e83847b82b">50bf43d3</a></li>
        <li>Database error exception added <code>code</code> returns <a href="https://github.com/swoft-cloud/swoft-component/pull/533/commits/fd306f470ba171f556bc05682aae58cab217cacc">fd306f4</a></li>
        <li>Coroutine file operation <code>writeFile</code> New write failure exception <a href="https://github.com/swoft-cloud/swoft-component/pull/533/commits/08c42449cc5ca7922e5bf54d6523b0d8799ba910">08c4244</a></li>
        <li>RPC new parameter verification <a href="https://github.com/swoft-cloud/swoft-component/pull/533/commits/8646fc5c64bcfeb84c0c38adb31ff2759a20726d">8646fc5</a></li>
      </ul>
      <h3>Github</h3>
      <p>
        <a href="https://github.com/swoft-cloud/swoft">https://github.com/swoft-cloud/swoft</a>
      </p>
      <related>
        <h4>Similar posts</h4>
        <a href="https://habr.com/en/post/460855/"/>
        <a href="https://habr.com/en/post/460147/"/>
        <a href="https://habr.com/en/post/449818/"/>
      </related>
    </article>
  </body>
</html>