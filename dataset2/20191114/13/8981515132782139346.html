<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://tproger.ru/video/smartwatch-on-esp8266/"/>
    <meta property="og:site_name" content="Tproger"/>
    <meta property="article:published_time" content="2019-11-14T13:06:41+00:00"/>
    <meta property="og:title" content="Умная техника своими руками: поэтапное создание смарт-часов на ESP8266"/>
    <meta property="og:description" content="В 1972 году компания Hamilton Watch разработала первые смарт-часы. Теперь вы можете сделать их сами. Разбираемся, как."/>
  </head>
  <body>
    <article>
      <h1>Умная техника своими руками: поэтапное создание смарт-часов на ESP8266</h1>
      <address><time datetime="2019-11-14T13:06:41+00:00">14 Nov 2019, 13:06</time> by <a rel="author">Александр Ланский</a></address>
      <p>Ещё в 1972 году компания Hamilton Watch разработала первые умные часы под маркой Pulsar. Изначально у таких часов было довольно мало вычислительной мощности. Её хватало только на калькуляторы, игровые устройства и тому подобные незамысловатые гаджеты. Но с развитием технологий мощность начала стремительно увеличиваться. Современные смарт-часы — это полноценные компьютеры. Некоторые могут работать автономно, а другие функционируют только в сопряжении со смартфоном.</p>
      <p>В этой статье будет описан принцип создания собственных смарт-часов на базе популярного микроконтроллера ESP8266.</p>
      <h3>Определение функциональности часов</h3>
      <p>В этой статье мырассмотрим часы, которые смогут выводить текущее время и дату, отображать погоду в вашем городе и позволят удалённо управлять Wi-Fi реле. Это означает, что прямо с часов вы сможете управлять любым прибором, подключённым к розетке, будь то музыкальный центр или электрочайник.</p>
      <p>Чтобы получать текущее время, необязательно использовать модуль реального времени. Если смарт-часы будут иметь доступ к интернету, то понадобится ближайший <a href="https://ru.wikipedia.org/wiki/NTP">NTP-сервер</a>. С его помощью можно достаточно точно узнать текущее время. Чтобы контролировать Wi-Fi реле в часах, будет использоваться Blynk.</p>
      <p><a href="https://blynk.io/">Blynk</a> — это облачный сервис, позволяющий с помощью приложения для Android или iOS контролировать устройства на Arduino, Raspberry Pi или же, в данном случае, ESP8266.</p>
      <h3>Подбор элементов</h3>
      <p>В часах элементами управления будут 3 тактовые кнопки. Экран тут используется доступный — двухцветный OLED 0’96. Для питания нужен аккумулятор, а для зарядки — специальный контроллер. В этих часах используется литий-ионный аккумулятор и соответствующий для него контроллер TP4056.</p>
      <p>Не стоит забывать, что ESP8266 работает на 3-вольтовой логике. Для получения необходимого напряжения питания можно использовать любой доступный стабилизатор напряжения на 3,3 В. Остаётся лишь немного деталей: разъём для зарядки, переключатель, несколько светодиодов, набор резисторов и пара конденсаторов.</p>
      <figure>
        <img src="https://cdn.tproger.ru/wp-content/uploads/2019/11/FIDTH5MJNSR8NUG.LARGE_.jpg"/>
        <figcaption>Необходимые для сборки часов элементы</figcaption>
      </figure>
      <h3>Создание и распайка печатной платы</h3>
      <p>Если хотите, чтобы итоговый вариант часов был надёжным и компактным, лучше всего распаять часы на печатной плате. Для создания рисунка печатной платы подойдут, к примеру, <a href="https://cxem.net/software/sprint_layout.php">Sprint Layout</a> или же <a href="https://easyeda.com/">EasyEDA</a>.</p>
      <figure>
        <img src="https://cdn.tproger.ru/wp-content/uploads/2019/11/FFFWK3FJNSR8SOU.LARGE_.jpg"/>
      </figure>
      <p>Вы можете создать печатную плату в домашних условиях либо заказать её у специализирующихся сервисов — те же EasyEDA или <a href="https://jlcpcb.com/">JLCPCB</a>. К этим смарт-часам в свободном доступе уже есть <a href="https://github.com/theTechnowright/DIY-Smartwatch-using-ESP8266/blob/master/ESP8266_SmartWatch.zip">Gerber PCB файлы печатной платы</a>.</p>
      <p>После получения/создания платы стоит распаять на ней все компоненты. Монтаж SMD компонентов удобнее делать паяльной пастой и паяльным феном. Но такую работу можно будет выполнить и обычным паяльником с тонким жалом.</p>
      <figure>
        <img src="https://cdn.tproger.ru/wp-content/uploads/2019/11/FTGDOIFJNUL8C7B.LARGE_.jpg"/>
      </figure>
      <h3>Подготовка прошивки часов</h3>
      <p>После того, как все компоненты будут распаяны, можно приступить к программной части. Вначале следует разобраться с API для получения погоды. К примеру, можно использовать <a href="https://developer.yahoo.com/weather/?guccounter=1">Weather API Yahoo</a>.</p>
      <p>Примечание С января 2019 года процесс работы с Weather API Yahoo немного изменился. Однако API всё ещё в бесплатном доступе. О том, как получить доступ, детально расписано на их странице.</p>
      <p>После получения ссылки с API можно приступить к прошивке микроконтроллера. Сам скетч для Arduino можно взять <a href="https://github.com/theTechnowright/DIY-Smartwatch-using-ESP8266/blob/master/ESP8266__SmartWatch.ino">здесь</a>.</p>
      <p>В первую очередь подставьте ваш код аутентификации Blynk в <code>char auth[]</code>. Этот код будет выслан вам на почту сразу после создания нового приложения в Blynk.</p>
      <p>Затем введите SSID и пароль от вашей точки доступа Wi-Fi в <code>char* ssid</code> и <code>char* password</code> соответственно.</p>
      <p>Скопированную из Weather API ссылку необходимо вставить в <code>const String url</code>.</p>
      <p>В <code>BLYNK_CONNECTED()</code> можно вставить код аутентификации Blynk другого ESP модуля, управляющего электрическим прибором (если такой имеется). Этот процесс можно увидеть в видео о <a href="https://www.youtube.com/watch?v=kPblG4l4gEs">создании Wi-Fi реле</a>. И под конец не забудьте в <code>TimeChangeRule</code> указать параметры вашего часового пояса (в методе <code>tellTime()</code>).</p>
      <h3>Прошивка микроконтроллера</h3>
      <p>Теперь в Arduino IDE нужно установить все необходимые библиотеки:</p>
      <ol>
        <li><a href="https://github.com/PaulStoffregen/Time">Time.h и TimeLib.h</a>.</li>
        <li><a href="https://github.com/JChristensen/Timezone">Timezone.h</a>.</li>
        <li><a href="https://github.com/ThingPulse/esp8266-oled-ssd1306">SSD1306.h и SSD1306Wire.h</a>.</li>
        <li><a href="https://github.com/arduino-libraries/NTPClient">NTPClient.h</a>.</li>
        <li><a href="https://github.com/ekstrand/ESP8266wifi">ESP8266WiFi.h и WifiUDP.h</a>.</li>
        <li><a href="https://github.com/blynkkk/blynk-library/releases/latest">Последняя версия Blynk</a>.</li>
      </ol>
      <p>Чтобы прошить ESP8266, нужно подключить его к мосту USB-UART. Все необходимые контакты уже выведены на торец печатной платы. Обратите внимание, что RX контакт одного подключается к TX контакту другого и наоборот. Более подробно о прошивке микроконтроллеров серии ESP8266 можно почитать тут:</p>
      <p>
        <a href="https://tproger.ru/articles/about-esp8266/">Знакомство с недорогим и функциональным микроконтроллером ESP8266: прошивка и пример использованияtproger.ru</a>
      </p>
      <p>Потом в Arduino IDE нужно будет выбрать текущую плату и COM-порт. Зажав кнопку flash на микроконтроллере, начните прошивку. После удачной прошивки остаётся лишь присоединить аккумулятор и ремешок.</p>
      <p>Включите часы. Должна высветиться надпись «Connected to Wi-Fi». Если это так, то микроконтроллер прошит, а значит, ваши смарт-часы готовы.</p>
      <figure>
        <img src="https://cdn.tproger.ru/wp-content/uploads/2019/11/FBOIR0NJNULE68P.LARGE_.jpg"/>
      </figure>
      <p>При нажатии на среднюю кнопку на часах будет отображаться текущая дата, время и температура. Две боковые кнопки управляют двумя подключёнными к Wi-Fi реле электрическими приборами.</p>
      <blockquote>Не смешно? А здесь смешно: <a href="https://tproger.ru/tg/ithumor">@ithumor</a></blockquote>
    </article>
  </body>
</html>