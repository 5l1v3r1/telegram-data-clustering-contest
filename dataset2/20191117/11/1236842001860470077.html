<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://dtf.ru/gamedev/81762-opisanie-principov-pbr-kakie-pravila-optiki-uchityvaet-fizicheski-korrektnyy-rendering"/>
    <meta property="og:site_name" content="DTF"/>
    <meta property="article:published_time" content="2019-11-17T11:54:03+00:00"/>
    <meta property="og:title" content="Описание принципов PBR: какие правила оптики учитывает физически-корректный рендеринг"/>
    <meta property="og:description" content="Немного теории о поведении света."/>
  </head>
  <body>
    <article>
      <h1>Описание принципов PBR: какие правила оптики учитывает физически-корректный рендеринг</h1>
      <address><time datetime="2019-11-17T11:54:03+00:00">17 Nov 2019, 11:54</time> by <a rel="author">Владимир Семыкин</a></address>
      <p>Немного теории о поведении света.</p>
      <p>Мы изучили видео с YouTube-канала Brackeys о принципах, на которых строится физически-корректный рендеринг (Physically Based Rendering). В игровой графике любой объект перед попаданием в финальное изображение должен пройти через процедуру рендеринга. Для такой визуализации могут использоваться разные подходы.</p>
      <p>PBR — это набор правил для рендеринга, который учитывает поведение света в реальности для создания правдоподобного изображения. Автор видео на YouTube-канале Brackeys описал основные правила, которыми пользуется PBR, и объяснил, почему графика получается настолько реалистичной. Рассказываем самое главное.</p>
      <figure>
        <iframe src="https://www.youtube.com/embed/_LaVvGlkBDs" width="640" height="360" data-service="Youtube" scrolling="no"/>
      </figure>
      <p>В реальном мире мы видим объекты благодаря тому, что свет падает на них, а глаз улавливает отражённые лучи. Так как все материалы по-разному отражают свет, мы можем отличить, например, дерево от металла.</p>
      <p>Кроме того, есть несколько особенностей поведения света, влияющих на изображение, которые мы улавливаем глазами. PBR учитывает правила распространения света в реальности и имитирует их в графике для создания правдоподобных объектов. Есть несколько основных принципов, которые учитывает эта концепция. Вот несколько из них.</p>
      <figure>
        <img src="https://leonardo.osnova.io/4eba2075-b565-e268-65e0-e552b43d1ba4/"/>
        <figcaption>​При отражении света угол падающего луча равен углу отражённого луча. Но это работает только с идеальной зеркальной поверхностью</figcaption>
      </figure>
      <figure>
        <img src="https://leonardo.osnova.io/b1a82b74-3b82-9835-9af2-5070baf173b9/"/>
        <figcaption>​В реальности одни материалы поглощают лучи...</figcaption>
      </figure>
      <figure>
        <img src="https://leonardo.osnova.io/41aca246-02cc-abd7-a806-ec5bf83c420d/"/>
        <figcaption>​... а другие рассеивают</figcaption>
      </figure>
      <figure>
        <img src="https://leonardo.osnova.io/873bb7bd-4f37-b791-a4e6-0601df7daa96/"/>
        <figcaption>​При рассеивании свет расходится во все стороны, из-за чего глаз человека видит сам материал</figcaption>
      </figure>
      <p>Это приводит нас к мысли, что у объектов, которые отлично отражают свет, нельзя увидеть материал, из которого они состоят. Это работает и в обратную сторону — мы отлично видим сам материал, если объект плохо отражает свет.</p>
      <figure>
        <img src="https://leonardo.osnova.io/33a2e06f-1c54-e1cb-e2c0-90051115c677/"/>
        <figcaption>У зеркальных объектов нельзя рассмотреть материал, из которого они сделаны​</figcaption>
      </figure>
      <p>Один из главных принципов PBR — объект не может отразить больше света, чем он получил. Также важное значение имеет гладкость материала.</p>
      <figure>
        <img src="https://leonardo.osnova.io/a91eacc5-4b71-3443-da61-a5101276729e/"/>
      </figure>
      <p>Разные материалы по-разному отражают свет. При этом особенно выделяются металлические объекты, которые отражают 60-90% падающего на них света, а остальные материалы — 0-20%. Другая особенность металлов — они могут «подкрашивать» отражённый свет, например, это делает медь или золото.</p>
      <p>Также есть свойство Френеля, которое заключается в том, что сила отражений зависит от угла зрения — чем ближе зеркальная поверхность к наблюдателю, тем слабее получится само отражение.</p>
      <figure>
        <img src="https://leonardo.osnova.io/718fac72-f397-75e2-04c7-d78ccd693962/"/>
        <figcaption>​Пример свойства отражения Френеля</figcaption>
      </figure>
      <figure>
        <img src="https://leonardo.osnova.io/518ac09f-1288-8de3-0803-6803c365123c/"/>
        <figcaption>Из-за эффекта Френеля отражения сильнее всего на границах объектов</figcaption>
      </figure>
      <figure>
        <img src="https://leonardo.osnova.io/5ebac34d-91ed-2ef6-17ae-fd05260ceb0f/"/>
        <figcaption>Отражение в реальности. Вблизи видно плитку под слоем воды, а вдали её уже не разобрать​</figcaption>
      </figure>
      <p>Эффект Френеля больше заметен на гладких поверхностях, но при этом он есть на всех объектах. И PBR учитывает эту особенность.</p>
      <p>На всех объектах есть несовершенства и изъяны, которые можно описать, как микроповерхность. Она играет большую роль в том, как свет отражается от материала.</p>
      <figure>
        <img src="https://leonardo.osnova.io/99f0db95-90a2-0252-07c1-df0f11a231d3/"/>
        <figcaption>Чем больше матовость объекта, тем более смазанным выглядит отражение</figcaption>
      </figure>
      <p>Концепция PBR используется во многих современных игровых движках и редакторах графики: Unreal Engine 4, Unity, Frostbite, Substance Designer и так далее. При этом PBR везде работает по похожему принципу.</p>
      <p>Например, в Unity есть стандартный шейдер, который автоматически настраивает все эти аспекты, чтобы материал выглядел реалистично. По-умолчанию шейдер позволяет создать металлический эффект, но это не значит, что он применим только для создания металлических объектов.</p>
      <figure>
        <img src="https://leonardo.osnova.io/1b5f3832-e922-8efe-8486-3b728d4f1b43/"/>
      </figure>
      <p>В стандартном шейдере можно настраивать цвет, «metalness» и гладкость. Но не всегда нужно, чтобы этот эффект покрывал весь объект, поэтому используются текстурные карты, на которых указаны конкретные области применения.</p>
      <p>Текстурная карта — это изображение, у которого цвет каждого пикселя определяется тремя каналами: красным, зелёным и синим. На самом деле у каждого пикселя есть ещё и альфа-канал, который обычно определяет прозрачность, но может использоваться и для других целей.</p>
      <p>Для изменения типа поверхности применяется рельефное текстурирование (normal maps), которое помогает усиливать детализацию без использования дополнительной геометрии. Это отлично подходит для изображения ударов, царапин и трещин.</p>
      <p>Карты высот (heightmaps) применяются, чтобы показать разные по высоте уровни ландшафта. Heightmaps работают по тому же принципу, что и normal maps, но их рендеринг происходит на основе более сложной техники.</p>
      <p>Occlusion maps используются, чтобы добавить объектам объём за счёт отображения освещённых и затенённых участков. Для этого применяются чёрно-белые текстуры.</p>
      <p>Концепция PBR учитывает поведение света в реальности, поэтому позволяет художникам значительно упростить создание фотореалистичной графики. Это значит, что разработчикам не нужно идти на разные хитрости, чтобы предметы выглядели правдоподобно. Тем не менее PBR лишь имитирует многие физические принципы, поэтому его возможности не безграничны, а результат всё так же зависит от умений и знаний художника.</p>
    </article>
  </body>
</html>