<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta property="og:url" content="https://habr.com/en/company/obyte/blog/477032/"/>
    <meta property="og:site_name" content="Habr"/>
    <meta property="article:published_time" content="2019-11-23T11:00:07+00:00"/>
    <meta property="og:title" content="От блокчейна к DAG: избавляемся от посредников"/>
    <meta property="og:description" content="В этой статье я расскажу вам о DAG (Directed Acyclic Graph, направленный ациклический граф) и его применении в распределённых реестрах, и мы сравним его с блокче..."/>
  </head>
  <body>
    <article>
      <h1>От блокчейна к DAG: избавляемся от посредников</h1>
      <address><time datetime="2019-11-23T11:00:07+00:00">23 Nov 2019, 11:00</time> by <a rel="author" href="https://habr.com/en/users/obyte-dev/" target="_blank">obyte-dev</a></address>
      <p>В этой статье я расскажу вам о DAG (Directed Acyclic Graph, направленный ациклический граф) и его применении в распределённых реестрах, и мы сравним его с блокчейном.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/11c/559/3db/11c5593dbab4892b5656f4359b15ef2e.png"/>
      </figure>
      <p>DAG не является чем-то новым в мире криптовалют. Возможно вы слышали о нём как о решении проблем масштабируемости блокчейнов. Но сегодня мы будем говорить не о масштабируемости, а о том, что делает криптовалюты отличными от всего остального: децентрализация, отсутствие посредников и устойчивость к цензуре.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/884/975/4c2/8849754c2f5986d58a6288ae52377349.png"/>
      </figure>
      <p>Также я покажу вам, что DAG на самом деле более устойчив к цензуре, и в нём отсутствуют посредники для доступа к реестру.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/02e/8ab/18f/02e8ab18f437218c4e324fdd3bfba4ed.png"/>
      </figure>
      <p>В привычных нам блокчейнах у пользователей нет прямого доступа к самому реестру. Когда вы хотите добавить транзакцию в реестр, вам приходится «просить» сделать это производителя блоков (блок-продюсера, он же «майнер»). Именно майнеры решают, какую транзакцию добавить в следующий блок, а какую — нет. Именно у майнеров есть эксклюзивный доступ к блокам и право решать, чью транзакцию принять для добавления в реестр.<br/><br/>Майнеры — это посредники, стоящие между вами и распределённым реестром.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/e04/ae3/56c/e04ae356c903f5c916006d75a4890b6b.png"/>
      </figure>
      <p>На практике же, обычно небольшое количество пулов майнеров коллективно контролируют более половины вычислительных мощностей сети. Для биткоина это четыре пула, для Ethereum — два. В случае их сговора, они могут блокировать любые транзакции, какие захотят.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/16c/96e/14f/16c96e14f3d5b4f11fb87589bf55ca0a.png"/>
      </figure>
      <p>За последние несколько лет было предложено множество вариаций блокчейнов, различающихся в принципах выбора производителей блока. Но сами производители блоков никуда не уходят, они всё ещё «стоят на шлагбауме»: каждая транзакция должна пройти через производителя блоков, и если он не принимает её, то транзакции, по факту, не существует.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/11c/559/3db/11c5593dbab4892b5656f4359b15ef2e.png"/>
      </figure>
      <p>Это неизбежная проблема в случае с блокчейном. И если мы хотим её решить, мы должны радикально изменить дизайн и полностью избавиться от блоков и производителей блоков. И вместо того, чтобы выстраивать цепочку блоков, мы будем соединять сами транзакции, включая в каждую транзакцию хеши нескольких предыдущих. В результате мы получим структуру, известную в математике как направленный ациклический граф – DAG.<br/><br/>Теперь каждый имеет прямой доступ к реестру, без посредников. Когда вы хотите добавить транзакцию в реестр – вы просто добавляете её. Выбираете несколько родительских транзакций, добавляете свои данные, подписываете и посылаете вашу транзакцию пирам в сети. Готово. Нет никого, кто бы мог помешать вам сделать это, поэтому ваша транзакция уже в реестре.<br/><br/>Это самый децентрализованный, самый неуязвимый перед цензурой способ добавления транзакций в реестр без посредников. Потому что каждый желающий просто добавляет свои транзакции в реестр, не спрашивая разрешения ни у кого.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/077/0fc/79c/0770fc79c8d7cddd8af9c337137c351e.png"/>
      </figure>
      <p>DAG можно считать третьей стадией эволюции реестров. Сначала были централизованные реестры, где одна сторона контролировала доступ к ним. Потом пришли блокчейны, в которых уже было несколько контролёров, которые записывали транзакции в реестр. И, наконец, в DAG вообще нет никаких контролёров, пользователи добавляют свои транзакции напрямую.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/4b9/37e/d1d/4b937ed1df42fda36d9d3031ea2c2b00.png"/>
      </figure>
      <p>Теперь, когда у нас есть такая свобода, она не должна приводить к хаосу. Мы должны иметь согласие о состоянии реестра. И это согласие, или консенсус, обычно означает согласие о двух вещах:</p>
      <ol>
        <li>Что произошло?</li>
        <li>В каком порядке это произошло?</li>
      </ol>
      <p>На первый вопрос мы легко можем ответить: как только правильно созданная транзакция была добавлена в реестр, она произошла. И точка. Информация об этом может доходить до всех участников в разное время, но в конце концов все ноды получат эту транзакцию и узнают, что она произошла.<br/><br/>Если бы это был блокчейн, майнеры бы решали, что происходит. Всё, что майнер решает включить в блок – то и происходит. Всё, что он не включает в блок – не происходит.<br/><br/>В блокчейнах майнеры также решают вторую проблему консенсуса: порядок. Им разрешено упорядочивать транзакции внутри блока как угодно.<br/><br/>Как же определить порядок транзакций в DAG?</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/55f/b8e/dbc/55fb8edbcff0278db23b3fe79eb0fcb1.png"/>
      </figure>
      <p>Только лишь потому, что граф у нас направленный, мы уже имеем некоторый порядок. Каждая транзакция ссылается на одну или несколько предыдущих, родительских. Родители, в свою очередь, ссылаются на своих родителей, и так далее. Родители, очевидно, появляются раньше дочерних транзакций. Если какая-либо из транзакций может быть достигнута переходами по ссылкам «родитель-ребёнок», мы точно знаем порядок между транзакциями в этой цепочке транзакций.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/070/235/cc0/070235cc0289abff458d7be6fd6c339e.png"/>
      </figure>
      <p>Но порядок между транзакциями не всегда можно определить только из формы графа. Например, когда две транзакции лежат на параллельных ветвях графа.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/571/c41/ab2/571c41ab2fa10df2cab5bd4460b7f74f.png"/>
      </figure>
      <p>Чтобы разрешить неоднозначность в таких случаях, мы полагаемся на так называемых провайдеров порядка. Мы также называем их «свидетелями». Это обычные пользователи, задачей которых является постоянная отправка транзакций в сеть с соблюдением порядка, т.е. так, что каждая их предыдущая транзакция может быть достигнута переходами по ссылкам «родитель-ребёнок». Провайдеры порядка – доверенные пользователи, и вся сеть полагается на то, что они не будут нарушать данное правило. Для того чтобы <b>рационально</b> доверять им, мы требуем, чтобы каждый провайдер порядка был известным (неанонимным) человеком или организаций и имел что-то, что может потерять в случае, если нарушит правила, например, репутацию или бизнес, основанный на доверии.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/744/ed3/e3b/744ed3e3b8aeaad9648d58f049e47ef0.png"/>
      </figure>
      <p>Провайдеры порядка выбираются пользователями, и каждый пользователь включает список его доверенных провайдеров в каждую транзакцию, которую отправляет в сеть. Этот список состоит из 12 провайдеров. Это довольно маленькое число, чтобы человек мог проверить личности и репутацию каждого из них, и достаточное для того, чтобы сеть продолжала работать в случае неизбежных проблем с меньшинством провайдеров порядка.<br/><br/>Данный список провайдеров варьируется от пользователя к пользователю, но списки у соседних транзакций могут отличаться максимум на одного провайдера.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/7b1/f10/121/7b1f10121c15252912bc3098474993dc.png"/>
      </figure>
      <p>Теперь, когда у нас есть провайдеры порядка, мы можем выделить их транзакции в DAG и упорядочить все другие транзакции вокруг порядка, созданного ими. Возможность создания такого алгоритма есть (см. <a href="https://obyte.org/Byteball.pdf">Obyte White Paper</a> для технических деталей).<br/><br/>Но порядок во всей сети не может быть определён моментально, нам требуется время на то чтобы провайдеры порядка отправили достаточное количество своих транзакций, чтобы удостовериться в итоговом порядке прошлых транзакций.<br/><br/>И, поскольку порядок определяется только позициями транзакций провайдеров в DAG, все ноды сети рано или поздно получат все транзакции и придут к одинаковому заключению относительно порядка транзакций.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/a1f/9fb/dc8/a1f9fbdc89f49696d128b6821a115b50.png"/>
      </figure>
      <p>Итак, мы имеем согласие относительно того, что считаем случившемся: любая транзакция, попавшая в DAG, случилась. Также мы имеем согласие о порядке событий: это либо видно исходя из родственных связей транзакций, или же выводится из порядка транзакций, отправленных провайдерами порядка. Значит мы имеем консенсус.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/307/860/b92/307860b920a87583c87ebc5b252a5ea3.png"/>
      </figure>
      <p>Данный вариант консенсуса мы имеем в Obyte. Несмотря на то, что доступ в реестр Obyte полностью децентрализован, консенсус относительно порядка транзакций всё ещё централизован, т.к. 10 из 12 провайдеров контролируются создателем (Антон Чурюмов), и только два из них – независимые. Мы ищем кандидатов, желающих стать одним из независимых провайдеров порядка, чтобы помочь нам децентрализовать установление порядка в реестре.<br/><br/>Недавно появился третий независимый кандидат, желающий установить и поддерживать ноду провайдера порядка – Университет Никосии.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/57a/1ac/cb0/57a1accb088e61b49707d8210d86bdae.png"/>
      </figure>
      <p>Теперь, как мы контролируем двойные траты (double-spends)?<br/><br/>По правилам, при обнаружении двух транзакций, тратящих одну и ту же монету, та транзакция, которая оказалась раньше в итоговом порядке всех транзакций, выигрывает. Вторая же инвалидируется алгоритмом консенсуса.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/5f1/21e/0b4/5f121e0b471a97dc7b1b97a63524ef79.png"/>
      </figure>
      <p>В случае, если имеется возможность установить порядок между двумя транзакциями, тратящими одну монету (по связям родитель-ребёнок), то все ноды сразу отклоняют такую попытку двойной траты.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/b93/5dc/dbb/b935dcdbb3b9fc3617e8e2ba1111208b.png"/>
      </figure>
      <p>В случае же, если порядок не виден из родительских связей между двумя такими транзакциями, они обе принимаются в реестр, и нам потребуется дождаться консенсуса и установления порядка между ними с помощью провайдеров порядка. Тогда выиграет более ранняя транзакция, а вторая станет невалидной.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/839/591/e6b/839591e6b792496f76685e309409abc4.png"/>
      </figure>
      <p>Хоть вторая транзакция и становится невалидной, она всё равно остаётся в реестре, потому как уже имеет последующие транзакции, ссылающиеся на неё, которые ничего не нарушали и не знали, что в будущем эта транзакция станет невалидной. Иначе нам пришлось бы удалять родителя у хороших последующих транзакций, что нарушило бы главный принцип сети – любая правильная транзакция принимается в реестр.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/a08/cb5/fcb/a08cb5fcbdcb41e49815fc6953c553b4.png"/>
      </figure>
      <p>Это очень важное правило, позволяющее всей системе быть устойчивой к попыткам цензуры. <br/><br/>Давайте представим, что все провайдеры порядка вступают в сговор в попытке «зацензурить» одну конкретную транзакцию. Они могут игнорировать её и никогда не выбирать «родителем» для своих транзакций, но этого недостаточно, эта транзакция всё ещё может быть включена опосредованно как родитель какой-нибудь другой транзакции, выпущенной любым пользователем сети, который не участвует в сговоре. С течением времени, такая транзакция будет получать всё больше и больше детей, внуков и правнуков от обычных пользователей, разрастаясь как снежный ком, и всем договорившимся провайдерам порядка придётся игнорировать и эти транзакции тоже. В конце концов, им придётся зацензурить всю сеть, что равносильно саботажу.</p>
      <figure>
        <img src="https://habrastorage.org/getpro/habr/post_images/884/975/4c2/8849754c2f5986d58a6288ae52377349.png"/>
      </figure>
      <p>Таким образом, DAG остаётся цензуро-устойчивым, даже если имеет место сговор провайдеров порядка, тем самым превосходя блокчейн по устойчивости к цензуре, в котором мы ничего не можем сделать, если майнеры решат не включать какую-либо из транзакций. И это следует из главного свойства DAG: участие в реестре абсолютно независимо и без посредников, а транзакции необратимы.</p>
      <footer>Source: <a href="https://medium.com/obyte/from-blockchain-to-dag-getting-rid-of-middlemen-28afa7563545">Original author: Tony Churyumoff</a></footer>
    </article>
  </body>
</html>